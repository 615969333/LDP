<!doctype linuxdoc system> 

<article>

<title>The Linux Sound HOWTO
<author>Jeff Tranter, <htmlurl url="mailto:tranter@pobox.com"
name="tranter@pobox.com">
<date>v1.20, 24 March 1999

<abstract>
This document describes sound support for Linux. It lists the
supported sound hardware, describes how to configure the kernel
drivers, and answers frequently asked questions. The intent is to
bring new users up to speed more quickly and reduce the amount of
traffic in the Usenet news groups and mailing lists.
</abstract>

<toc>

<sect>Introduction<p>

This is the Linux Sound HOWTO. It is intended as a quick reference
covering everything you need to know to install and configure sound
support under Linux. Frequently asked questions about sound under
Linux are answered, and references are given to some other sources of
information on a variety of topics related to computer generated sound
and music.

The scope is limited to the aspects of sound cards pertaining to
Linux. See the other documents listed in the <em>References</em>
section for more general information on sound cards and computer sound
and music generation.

<sect1>Acknowledgments<p>

Much of this information came from the documentation provided with the
sound driver source code, by Hannu Savolainen (<htmlurl
url="mailto:hannu@opensound.com" name="hannu@opensound.com">). Thanks
go to Hannu, Alan Cox, and the many other people who developed the
Linux kernel sound drivers and utilities.

Thanks to the <htmlurl
url="ftp://metalab.unc.edu/pub/Linux/utils/text/sgml-tools-0.99.0.tar.gz"
name="SGML Tools"> package, this HOWTO is available in several
formats, all generated from a common source file.

<sect1>New versions of this document<p>

New versions of this document will be periodically posted to the
<htmlurl url="news:comp.os.linux.answers"
name="comp.os.linux.answers"> newsgroup. They will also be uploaded
to various anonymous ftp sites that archive such information including
<url url="ftp://metalab.unc.edu/pub/Linux/docs/HOWTO/">.

Hypertext versions of this and other Linux HOWTOs are available on
many world-wide web sites, including <url
url="http://metalab.unc.edu/LDP/">. Most Linux CD-ROM
distributions include the HOWTOs, often under the
<file>/usr/doc</file> directory, and you can also buy printed copies from
several vendors. Sometimes the HOWTOs available from CD-ROM vendors,
ftp sites, and printed format are out of date. If the date on this
HOWTO is more than six months in the past, then a newer copy is
probably available on the Internet.

<em>Please note that, due to the dynamic nature of the Internet, all
web and ftp links listed in this document are subject to change.</em>

Translations of this document are available in several languages:

Chinese: <url url="http://www.linux.org.tw/CLDP/Sound-HOWTO.html">

French: <url url="http://www.freenix.org/unix/linux/HOWTO/">

Japanese: <url url="http://yebisu.ics.es.osaka-u.ac.jp/linux/">

Korean: <url url="http://kldp.linux-kr.org/HOWTO/html/Sound/Sound-HOWTO.html">

Russian: <url url="http://www.phtd.tpu.edu.ru/~ott/russian/linux/howto-rus/Sound-HOWTO.html">

Spanish: <url url="ftp://ftp.insflug.org/es">

Most translations of this and other Linux HOWTOs can also be found at
<url url="http://metalab.unc.edu/pub/Linux/docs/HOWTO/translations/">
and <url
url="ftp://metalab.unc.edu/pub/Linux/docs/HOWTO/translations/">. If
you make a translation of this document into another language, let me
know and I'll include a reference to it here.

<sect1>Feedback<p>

I rely on you, the reader, to make this HOWTO useful. If you have any
suggestions, corrections, or comments, please send them to me,
<htmlurl url="mailto:tranter@pobox.com" name="tranter@pobox.com">, and
I will try to incorporate them in the next revision.

I am also willing to answer general questions on sound cards under
Linux, as best I can. Before doing so, please read all of the
information in this HOWTO, and send me detailed information about the
problem. Please do not ask me about using sound cards under operating
systems other than Linux.

If you publish this document on a CD-ROM or in hardcopy form, a
complimentary copy would be appreciated. Mail me for my postal
address. Also consider making a donation to the Linux Documentation
Project to help support free documentation for Linux. Contact the
Linux HOWTO coordinator, Tim Bynum <url
url="mailto:linux-howto@metalab.unc.edu">, for more information.

<sect1>Distribution Policy<p>

Copyright (c) 1995-1999 by Jeff Tranter. This document may be
distributed under the terms set forth in the LDP license at <url
url="http://metalab.unc.edu/LDP/COPYRIGHT.html">.

<sect>Sound Card Technology<p>

This section gives a <em>very</em> cursory overview of <idx>computer
audio</idx> technology, in order to help you understand the concepts
used later in the document. You should consult a book on digital audio
or digital signal processing in order to learn more.

Sound is an <em>analog</em> property; it can take on any value over a
continuous range. Computers are <em>digital</em>; they like to work
with discrete values. Sound cards use a device known as an <em>Analog
to Digital Converter</em> (A/D or ADC) to convert voltages
corresponding to analog sound waves into digital or numeric values
which can be stored in memory. Similarly, a <em>Digital to Analog
Converter</em> (D/A or DAC) converts numeric values back to an analog
voltage which can in turn drive a loudspeaker, producing sound.

The process of <idx>analog to digital conversion</idx>, known as
sampling, introduces some error. Two factors are key in determining
how well the sampled signal represents the original. <em>Sampling
rate</em> is the number of samples made per unit of time (usually
expresses as samples per second or Hertz). A low <idx>sampling
rate</idx> will provide a less accurate representation of the analog
signal. Sample size is the range of values used to represent each
sample, usually expressed in bits. The larger the sample size, the
more accurate the digitized signal will be.

Sound cards commonly use 8 or 16 bit samples at sampling rates from
about 4000 to 44,000 samples per second. The samples may also be
contain one channel (mono) or two (stereo).

<em><idx>FM Synthesis</idx></em> is an older technique for producing
sound. It is based on combining different waveforms (e.g. sine,
triangle, square). <idx>FM synthesis</idx> is simpler to implement in
hardware that D/A conversion, but is more difficult to program and
less flexible. Many sound cards provide FM synthesis for backward
compatibility with older cards and software. Several independent sound
generators or <em>voices</em> are usually provided.

<em><idx>Wavetable Synthesis</idx></em> combines the flexibility of
D/A conversion with the multiple channel capability of FM
synthesis. With this scheme digitized voices can be downloaded into
dedicated memory, and then played, combined, and modified with little
CPU overhead. State of the art sound cards all support wavetable
synthesis.

Most sound cards provide the capability of <em>mixing</em>, combining
signals from different input sources and controlling gain levels.

<em><idx>MIDI</idx></em> stands for Musical Instrument Digital
Interface, and is a standard hardware and software protocol for
allowing musical instruments to communicate with each other. The
events sent over a MIDI bus can also be stored as MIDI files for later
editing and playback. Many sound cards provide a MIDI interface. Those
that do not can still play MIDI files using the on-board capabilities
of the sound card.

<em><idx>MOD files</idx></em> are a common format for computer
generated songs. As well as information about the musical notes to be
played, the files contain digitized samples for the instruments (or
voices). MOD files originated on the Amiga computer, but can be played
on other systems, including Linux, with suitable software.

<sect>Supported Hardware<p>

This section lists the <idx>sound cards</idx> and interfaces that are
currently supported under Linux. The information here is based on the
latest Linux kernel, which at time of writing was version 2.2.4. This
document only applies to the sound drivers included with the standard
Linux kernel source distribution. There are other sound drivers
available for Linux (see the later section entitled Alternate Sound
Drivers).

For the latest information on supported sound cards and features see
the files included with the Linux kernel source code, usually
installed in the directory
<file>/usr/src/linux/Documentation/sound</file>.

The information in this HOWTO is valid for Linux on the Intel
platform.

The sound driver should also work with most sound cards on the
<idx>Alpha</idx> platform. However, some cards may conflict with I/O
ports of other devices on Alpha systems even though they work
perfectly on i386 machines, so in general it's not possible to tell if
a given card will work or not without actually trying it.

Users have reported that the sound driver was not yet working on the
<idx>PowerPC</idx> version of Linux, but it should be supported in
future.

Sound can be configured into the kernel under the <idx>MIPs</idx> port
of Linux, and some MIPs machines have EISA slots and/or built in sound
hardware. I'm told the Linux-MIPs group is interested in adding sound
support in the future.

The Linux kernel includes a separate driver for the <idx>Atari</idx>
and <idx>Amiga</idx> versions of Linux that implements a compatible
subset of the sound driver on the Intel platform using the built-in
sound hardware on these machines.

The <idx>SPARC</idx> port of Linux currently has sound support for
some models of Sun workstations. I've been told that the on-board
sound hardware works but the external DSP audio box is not supported
because Sun has not released the specifications for it.

<sect1>Sound Cards<p>

The following <idx>sound cards</idx> are supported by the Linux kernel
sound driver. Some of the items listed are audio chip sets rather than
models of sound cards. The list is incomplete because there are many
sound cards compatible with these that will work under Linux. To add
further to the confusion, some manufacturers periodically change the
design of their cards causing incompatibilities and continue to sell
them as the same model.

<itemize>
<item>6850 UART MIDI Interface
<item>AD1816/AD1816A based cards
<item>ADSP-2115
<item>ALS-007 based cards (Avance Logic)
<item>ATI Stereo F/X (no longer manufactured)
<item>Acer FX-3D
<item>AdLib (no longer manufactured)
<item>Audio Excel DSP 16
<item>AudioDrive
<item>CMI8330 sound chip
<item>Compaq Deskpro XL onboard sound
<item>Corel Netwinder WaveArtist
<item>Crystal CS423x
<item>ESC614
<item>ESS1688 sound chip
<item>ESS1788 sound chip
<item>ESS1868 sound chip
<item>ESS1869 sound chip
<item>ESS1887 sound chip
<item>ESS1888 sound chip
<item>ESS688 sound chip
<item>ES1370 sound chip
<item>ES1371 sound chip
<item>Ensoniq AudioPCI (ES1370)
<item>Ensoniq AudioPCI 97 (ES1371)
<item>Ensoniq SoundScape (and compatibles made by Reveal and Spea)
<item>Gallant SC-6000
<item>Gallant SC-6600
<item>Gravis Ultrasound
<item>Gravis Ultrasound ACE
<item>Gravis Ultrasound Max
<item>Gravis Ultrasound with 16 bit sampling option
<item>HP Kayak
<item>Highscreen Sound-Booster 32 Wave 3D
<item>IBM MWAVE
<item>Logitech Sound Man 16
<item>Logitech SoundMan Games
<item>Logitech SoundMan Wave
<item>MAD16 Pro (OPTi 82C928, 82C929, 82C930, 82C924 chipsets)
<item>Media Vision Jazz16
<item>MediaTriX AudioTriX Pro
<item>Microsoft Windows Sound System (MSS/WSS)
<item>MiroSOUND PCM12
<item>Mozart (OAK OTI-601)
<item>OPTi 82C931
<item>Orchid SW32
<item>Personal Sound System (PSS)
<item>Pinnacle MultiSound
<item>Pro Audio Spectrum 16
<item>Pro Audio Studio 16
<item>Pro Sonic 16
<item>Roland MPU-401 MIDI interface
<item>S3 SonicVibes
<item>SY-1816
<item>Sound Blaster 1.0 
<item>Sound Blaster 2.0
<item>Sound Blaster 16
<item>Sound Blaster 16ASP
<item>Sound Blaster 32
<item>Sound Blaster 64
<item>Sound Blaster AWE32
<item>Sound Blaster AWE64
<item>Sound Blaster PCI 128
<item>Sound Blaster Pro
<item>Sound Blaster Vibra16
<item>Sound Blaster Vibra16X
<item>TI TM4000M notebook
<item>Terratec Base 1
<item>Terratec Base 64
<item>ThunderBoard
<item>Turtle Beach Maui
<item>Turtle Beach MultiSound Classic
<item>Turtle Beach MultiSound Fiji
<item>Turtle Beach MultiSound Hurricane
<item>Turtle Beach MultiSound Monterey
<item>Turtle Beach MultiSound Pinnacle
<item>Turtle Beach MultiSound Tahiti
<item>Turtle Beach WaveFront Maui
<item>Turtle Beach WaveFront Tropez
<item>Turtle Beach WaveFront Tropez+
<item>VIA chip set
<item>VIDC 16-bit sound
<item>Yamaha OPL2 sound chip
<item>Yamaha OPL3 sound chip
<item>Yamaha OPL3-SA1 sound chip
<item>Yamaha OPL3-SA2 sound chip
<item>Yamaha OPL3-SA3 sound chip
<item>Yamaha OPL3-SAx sound chip
<item>Yamaha OPL4 sound chip
</itemize>

A word about compatibility: even though most sound cards are claimed
to be <em>SoundBlaster compatible</em>, very few currently sold cards are
compatible enough to work with the Linux SoundBlaster driver. These
cards usually work better using the MSS/WSS or MAD16 driver. Only real
SoundBlaster cards made by Creative Labs, which use Creative's custom
chips (e.g. SoundBlaster16 Vibra), MV Jazz16 and ESS688/1688 based
cards generally work with the SoundBlaster driver. Trying to use a
SoundBlaster Pro compatible 16 bit sound card with the SoundBlaster
driver is usually just a waste of time.

The Linux kernel supports the SCSI port provided on some sound cards
(e.g. ProAudioSpectrum 16) and the proprietary interface for some
CD-ROM drives (e.g. Soundblaster Pro). See the Linux <htmlurl
url="ftp://metalab.unc.edu/pub/Linux/docs/HOWTO/unmaintained/SCSI-HOWTO"
name="SCSI HOWTO"> and <htmlurl
url="http://metalab.unc.edu/LDP/HOWTO/CDROM-HOWTO.html" name="CDROM
HOWTO"> documents for more information.

A kernel driver to support <idx>joystick</idx> ports, including those
provided on some sound cards, is included as part of the 2.2 kernels.

Note that the kernel SCSI, CD-ROM, joystick, and sound drivers are
completely independent of each other.

<sect1>Alternate Sound Drivers<p>

Sound support in the Linux kernel was originally written by Hannu
Savolainen. Hannu then went on to develop the Open Sound system, a
commercial set of sound drivers sold by 4Front Technologies that is
supported on a number of Unix systems. Red Hat Software sponsored Alan
Cox to enhance the kernel sound drivers to make them fully
modular. Various other people also contributed bug fixes and developed
additional drivers for new sound cards. These modified drivers were
shipped by Red Hat in their 5.0 through 5.2 releases. These changes
have now been integrated into the standard kernel as of version
2.0. Alan Cox is now the maintainer of the standard kernel sound
drivers, although Hannu still periodically contributes code taken from
the commercial driver.

The commercial Open Sound System driver from 4Front Technologies tends
to be easier to configure and support more sound cards, particularly
the newer models. It is also compatible with applications written for
the standard kernel sound drivers. The disadvantage is that you need
to pay for it, and you do not get source code. You can download a free
evaluation copy of the product before deciding whether to purchase it.
For more information see the <idx>4Front Technologies</idx> web page
at <url url="http://www.opensound.com">.

Jaroslav Kysela and others started writing an alternate sound driver
for the Gravis UltraSound Card. The project was renamed <em>Advanced
Linux Sound Architecture</em> (ALSA) and has resulted in what they
believe is a more generally usable sound driver that can be used as a
replacement for the built-in kernel drivers. The ALSA drivers support
a number of popular sound cards, are full duplex, fully modularized,
and compatible with the sound architecture in the kernel. The main web
site of the ALSA project is <url url="http://www.alsa-project.org">. A
separate "Alsa-sound-mini-HOWTO" is available which deals with
compiling and installing these drivers.

Markus Mummert (<htmlurl url="mailto:mum@mmk.e-technik.tu-muenchen.de"
name="mum@mmk.e-technik.tu-muenchen.de">) has written a driver package
for the Turtle Beach MultiSound (classic), Tahiti, and Monterey sound
cards. The documentation states:

<quote>
It is designed for high quality hard disk recording/playback without
losing sync even on a busy system. Other features such as wave
synthesis, MIDI and digital signal processor (DSP) cannot be
used. Also, recording and playback at the same time is not
possible. It currently replaces VoxWare and was tested on several
kernel versions ranging from 1.0.9 to 1.2.1. Also, it is installable
on UN*X SysV386R3.2 systems.
</quote>

It can be found at <url
url="http://www.cs.colorado.edu/~mccreary/tbeach">.

Kim Burgaard (<htmlurl url="mailto:burgaard@daimi.aau.dk"
name="burgaard@daimi.aau.dk">) has written a device driver and
utilities for the Roland MPU-401 <idx>MIDI</idx> interface. The Linux
software map entry gives this description:

<quote>
A device driver for true Roland MPU-401 compatible MIDI interfaces
(including Roland SCC-1 and RAP-10/ATW-10). Comes with a useful
collection of utilities including a Standard MIDI File player and
recorder.
</quote>

<quote>
Numerous improvements have been made since version 0.11a. Among other
things, the driver now features IRQ sharing policy and complies with
the new kernel module interface. Metronome functionality, possibility
for synchronizing e.g. graphics on a per beat basis without losing
precision, advanced replay/record/overdub interface and much, much
more.
</quote>

It can be found at <url
url="ftp://metalab.unc.edu/pub/Linux/kernel/sound/mpu401-0.2.tar.gz">.

Another novel use for a sound card under Linux is as a modem for
amateur <idx>packet radio</idx>. The 2.1 and later kernels include a
driver that works with SoundBlaster and Windows Sound System
compatible sound cards to implement 1200 bps AFSK and 9600 bps FSK
packet protocols. See the Linux AX25 HOWTO for details (I'm a ham
myself, by the way -- callsign VE3ICH).

<sect1>PC Speaker<p>

An alternate sound driver is available that requires no additional
sound hardware; it uses the internal <idx>PC speaker</idx>. It is
mostly software compatible with the sound card driver, but, as might
be expected, provides much lower quality output and has much more CPU
overhead. The results seem to vary, being dependent on the
characteristics of the individual loudspeaker. For more information,
see the documentation provided with the release.

The software, which has not been updated for some time, can be found
at <url url="ftp://ftp.informatik.hu-berlin.de/pub/Linux/hu-sound/">.

<sect1>Parallel Port<p>

Another option is to build a digital to analog converter using a
parallel printer port and some additional components. This provides
better sound quality than the PC speaker but still has a lot of CPU
overhead. The PC sound driver package mentioned above supports this,
and includes instructions for building the necessary hardware.

<sect>Installation<p>

Configuring Linux to support sound involves the following steps:

<enum>
<item>Installing the sound card.
<item>Configuring Plug and Play (if applicable).
<item>Configuring and building the kernel for sound support.
<item>Creating the device files.
<item>Booting the Linux kernel and testing the installation.
</enum>

If you are running Red Hat Linux there is a utility called
<tt>sndconfig</tt> that in most cases will detect your sound card and
set up all of the necessary configuration files to load the
appropriate sound drivers for your card. If you are running Red Hat I
suggest you try using it. If it works for you then you can skip the
rest of the instructions in this section.

If <tt>sndconfig</tt> fails, you are using another Linux distribution,
or you want to follow the manual method in order to better understand
what you are doing, then the next sections will cover each of these
steps in detail.

<sect1>Installing the Sound Card<p>

Follow the manufacturer's instructions for installing the hardware or
have your dealer perform the installation.

Older sound cards usually have switch or <idx>jumper settings</idx>
for IRQ, DMA channel, etc; note down the values used. If you are
unsure, use the factory defaults. Try to avoid conflicts with other
devices (e.g. ethernet cards, SCSI host adaptors, serial and parallel
ports) if possible.

Usually you should use the same I/O port, IRQ, and DMA settings that
work under DOS. In some cases though (particularly with PnP cards) you
may need to use different settings to get things to work under Linux.
Some experimentation may be needed.

<sect1>Configuring Plug and Play<p>

Most sound cards now use the Plug and Play protocol to configure
settings for i/o addresses, interrupts, and DMA channels. If you have
one of the older sound cards that uses fixed settings or jumpers, then
you can skip this section.

As of version 2.2 Linux does not yet have full Plug and Play support
in the kernel. The preferred solution is to use the isapnp tools which
ship with most Linux distributions (or you can download them from Red
Hat's web site <url url="http://www.redhat.com/">).

First check the documentation for your Linux distribution. It may
already have Plug and Play support set up for you or it may work
slightly differently than described here. If you need to configure it
yourself,the details can be found in the man pages for the isapnp
tools. Briefly the process you would normally follow is:

<itemize>

<item> Use <tt>pnpdump</tt> to capture the possible settings for all
your Plug and Play devices, saving the result to the file
<file>/etc/isapnp.conf</file>.

<item> Choose settings for the sound card that do not conflict with
any other devices in your system and uncomment the appropriate lines
in <file>/etc/isapnp.conf</file>. Don't forget to uncomment the
<tt>(ACT Y)</tt> command near the end.

<item> Make sure that <tt>isapnp</tt> is run when your system boots
up, normally done by one of the startup scripts. Reboot your system or
run <tt>isapnp</tt> manually.

</itemize>

If for some reason you cannot or do not wish to use the isapnp tools,
there are a couple of other options. If you use the card under
Microsoft Windows 95 or 98, you can use the device manager to set up
the card, then soft boot into Linux using the LOADLIN program. Make
sure Windows and Linux use the same card setup parameters.

If you use the card under DOS, you can use the <tt>icu</tt> utility
that comes with SoundBlaster16 PnP cards to configure it under DOS,
then soft boot into Linux using the LOADLIN program. Again, make sure
DOS and Linux use the same card setup parameters.

A few of the sound card drivers include the necessary software to
initialize Plug and Play for the card. Check the documentation for
that card's driver for details.

<sect1>Configuring the Kernel<p>

When initially installing Linux you likely used a precompiled
kernel. These kernels often do not provide sound support. It is best
to recompile the kernel yourself with the drivers you need. You may
also want to recompile the kernel in order to upgrade to a newer
version or to free up memory resources by minimizing the size of the
kernel. Later, when your sound card is working, you may wish to
rebuild the kernel sound drivers as modules.

The <url url="http://metalab.unc.edu/LDP/HOWTO/Kernel-HOWTO.html"
name="Linux Kernel HOWTO"> should be consulted for the details of
building a kernel. I will just mention here some issues that are
specific to sound cards.

If you have never configured the kernel for sound support before it is
a good idea to read the relevant documentation included with the
kernel sound drivers, particularly information specific to your card
type. The files can be found in the kernel documentation directory,
usually installed in <file>/usr/src/linux/Documentation/sound</file>.
If this directory is missing you likely either have a very old kernel
version or you have not installed the kernel source code.

Follow the usual procedure for building the kernel. There are
currently three interfaces to the configuration process. A graphical
user interface that runs under X11 can be invoked using <tt>make
xconfig</tt>. A menu-based system that only requires text displays is
available as <tt>make menuconfig</tt>. The original method, using
<tt>make config</tt>, offers a simple text-based interface.

When configuring the kernel there will be many choices for selecting
the type of sound card you have and the driver options to use.
The on-line help within the configuration tool should provide
an explanation of what each option is for. Select the appropriate
options to the best of your knowledge.

After configuring the options you should compile and install the new
kernel as per the Kernel HOWTO.

<sect1>Creating the Device Files<p>

For proper operation, device file entries must be created for the
sound devices. These are normally created for you during installation
of your Linux system. A quick check can be made using the command
listed below. If the output is as shown (the date stamp will vary)
then the device files are almost certainly okay.

<tscreen><verb>
% ls -l /dev/sndstat
crw-rw-rw-   1 root     root      14,   6 Apr 25  1995 /dev/sndstat
</verb></tscreen>

Note that having the right device files there doesn't guarantee
anything on its own. The kernel driver must also be loaded or compiled
in before the devices will work (more on that later).

In rare cases, if you believe the device files are wrong, you can
recreate them. Most Linux distributions have a <tt>/dev/MAKEDEV</tt>
script which can be used for this purpose.

<sect1>Booting Linux and Testing the Installation<p>

You should now be ready to boot the new kernel and test the sound
drivers. Follow your usual procedure for installing and rebooting the
new kernel (keep the old kernel around in case of problems, of
course).

During booting, check for a message such as the following on powerup
(if they scroll by too quickly to read, you may be able to retrieve
them with the <tt>dmesg</tt> command):

<tscreen><verb>
Sound initialization started
<Sound Blaster 16 (4.13)> at 0x220 irq 5 dma 1,5
<Sound Blaster 16> at 0x330 irq 5 dma 0
<Yamaha OPL3 FM> at 0x388
Sound initialization complete
</verb></tscreen>

This should match your sound card type and jumper settings (if any).

Note that the above messages are not displayed when using loadable
sound driver module (unless you enable it, e.g. using <tt>insmod sound
trace_init=1</tt>).

When the sound driver is linked into the kernel, the <tt>Sound
initialization started</tt> and <tt>Sound initialization complete</tt>
messages should be displayed. If they are not printed, it means that
there is no sound driver present in the kernel. In this case you
should check that you actually installed the kernel you compiled when
enabling the sound driver.

If nothing is printed between the <tt>Sound initialization
started</tt> and the <tt>Sound initialization complete</tt> lines, it
means that no sound devices were detected. Most probably it means that
you don't have the correct driver enabled, the card is not supported,
the I/O port is bad or that you have a PnP card that has not been
configured.

The driver may also display some error messages and warnings during
boot. Watch for these when booting the first time after configuring
the sound driver.

Next you should check the device file
<file>/dev/sndstat</file>. Reading the sound driver status device file
should provide additional information on whether the sound card driver
initialized properly. Sample output should look something like this:

<tscreen><verb>
% cat /dev/sndstat
Sound Driver:3.5.4-960630 (Sat Jan 4 23:56:57 EST 1997 root,
Linux fizzbin 2.0.27 #48 Thu Dec 5 18:24:45 EST 1996 i586)
Kernel: Linux fizzbin 2.0.27 #48 Thu Dec 5 18:24:45 EST 1996 i586
Config options: 0

Installed drivers: 
Type 1: OPL-2/OPL-3 FM
Type 2: Sound Blaster
Type 7: SB MPU-401

Card config: 
Sound Blaster at 0x220 irq 5 drq 1,5
SB MPU-401 at 0x330 irq 5 drq 0
OPL-2/OPL-3 FM at 0x388 drq 0

Audio devices:
0: Sound Blaster 16 (4.13)

Synth devices:
0: Yamaha OPL-3

Midi devices:
0: Sound Blaster 16

Timers:
0: System clock

Mixers:
0: Sound Blaster
</verb></tscreen>

The command above can report some error messages. "No such file or
directory" indicates that you need to create the device files (see
section 4.3). "No such device" means that sound driver is not loaded
or linked into kernel. Go back to section 4.2 to correct this.

If lines in the "Card config:" section of <tt>/dev/sndstat</tt> are
listed inside parentheses (such as "(SoundBlaster at 0x220 irq 5 drq
1,5)"), it means that this device was configured but not detected.

Now you should be ready to play a simple sound file. Get hold of a
sound sample file, and send it to the sound device as a basic check of
sound output, e.g.

<tscreen><verb>
% cat endoftheworld >/dev/dsp
% cat crash.au >/dev/audio
</verb></tscreen>

(Make sure you don't omit the "&gt;" in the commands above).

Note that, in general, using <tt>cat</tt> is not the proper way to
play audio files, it's just a quick check. You'll want to get a proper
sound player program (described later) that will do a better job.

This command will work only if there is at least one device listed in
the audio devices section of <tt>/dev/sndstat</tt>. If the audio
devices section is empty you should check why the device was not
detected.

If the above commands return "I/O error", you should look at the
end of the kernel messages listed using the "dmesg" command. It's
likely that an error message is printed there. Very often the message
is "Sound: DMA (output) timed out - IRQ/DRQ config error?". The above
message means that the driver didn't get the expected interrupt from
the sound card. In most cases it means that the IRQ or the DMA channel
configured to the driver doesn't work. The best way to get it working
is to try with all possible DMAs and IRQs supported by the device.

Another possible reason is that the device is not compatible with the
device the driver is configured for. This is almost certainly the case
when a supposedly "SoundBlaster (Pro/16) compatible" sound card
doesn't work with the SoundBlaster driver. In this case you should try
to find out the device your sound card is compatible with (by posting
to the comp.os.linux.hardware newsgroup, for example).

Some sample sound files can be obtained from <url
url="ftp://tsx-11.mit.edu/pub/linux/packages/sound/snd-data-0.1.tar.Z">

Now you can verify sound recording. If you have sound input
capability, you can do a quick test of this using commands such as the
following:

<tscreen><verb>
# record 4 seconds of audio from microphone
EDT% dd bs=8k count=4 &etago;dev/audio >sample.au
4+0 records in
4+0 records out
# play back sound
% cat sample.au >/dev/audio
</verb></tscreen>

Obviously for this to work you need a microphone connected to the
sound card and you should speak into it. You may also need to obtain a
mixer program to set the microphone as the input device and adjust the
recording gain level.

If these tests pass, you can be reasonably confident that the sound
D/A and A/D hardware and software are working. If you experience
problems, refer to the next section of this document.

<sect1>Troubleshooting<p>

If you still encounter problems after following the instructions in
the HOWTO, here are some things to check. The checks are listed in
increasing order of complexity. If a check fails, solve the problem
before moving to the next stage.

<sect2>Step 1: Make sure you are really running the kernel you compiled.<p>

You can check the date stamp on the kernel to see if you are running
the one that you compiled with sound support. You can do this with the
<tt>uname</tt> command:

<tscreen><verb>
% uname -a
Linux fizzbin 2.2.4 #1 Tue Mar 23 11:23:21 EST 1999 i586 unknown
</verb></tscreen>

or by displaying the file <file>/proc/version</file>:

<tscreen><verb>
% cat /proc/version
Linux version 2.2.4 (root@fizzbin) (gcc version 2.7.2.3) #1 Tue Mar 23 11:23:21 EST 1999
</verb></tscreen>

If the date stamp doesn't seem to match when you compiled the kernel,
then you are running an old kernel. Did you really reboot? If you use
LILO, did you re-install it (typically by running
<file>lilo</file>)? If booting from floppy, did you create a
new boot floppy and use it when booting?

<sect2>Step 2: Make sure the kernel sound drivers are compiled in.<p>

The easiest way to do this is to check the output of
<tt>dev/sndstat</tt> as described earlier. If the output is not as
expected then something went wrong with the kernel configuration or
build. Start the installation process again, beginning with
configuration and building of the kernel.

<sect2>Step 3: Did the kernel detect your sound card during booting?<p>

Make sure that the sound card was detected when the kernel booted. You
should have seen a message on bootup. If the messages scrolled off the
screen, you can usually recall them using the <tt>dmesg</tt> command:

<tscreen><verb>
% dmesg
</verb></tscreen>

or

<tscreen><verb>
% tail /var/log/messages
</verb></tscreen>

If your sound card was not found then something is wrong. Make sure it
really is installed. If the sound card works under DOS then you can be
reasonably confident that the hardware is working, so it is likely a
problem with the kernel configuration. Either you configured your
sound card as the wrong type or wrong parameters, or your sound card
is not compatible with any of the Linux kernel sound card drivers.

One possibility is that your sound card is one of the
<em>compatible</em> type that requires initialization by the DOS
driver. Try booting DOS and loading the vendor supplied sound card
driver. Then soft boot Linux using <tt>Control-Alt-Delete</tt>. Make
sure that card I/O address, DMA, and IRQ settings for Linux are the
same as used under DOS. Read the <file>Readme.cards</file> file from
the sound driver source distribution for hints on configuring your
card type.

If your sound card is not listed in this document, it is possible that
the Linux drivers do not support it. You can check with some of the
references listed at the end of this document for assistance.

<sect2>Step 4: Can you read data from the dsp device?<p>

Try reading from the <file>/dev/audio</file> device using the <tt>dd</tt>
command listed earlier in this document. The command should run
without errors.

If it doesn't work, then chances are that the problem is an IRQ or DMA
conflict or some kind of hardware incompatibility (the device is not
supported by Linux or the driver is configured for a wrong device).

A remote possibility is broken hardware. Try testing the sound card
under DOS, if possible, to eliminate that as a possibility.

<sect2>When All Else Fails<p>

If you still have problems, here are some final suggestions for things
to try:

<itemize>
<item>carefully re-read this HOWTO document
<item>read the references listed at the end of this document
and the relevant kernel source documentation files
<item>post a question to one of the <tt>comp.os.linux</tt> or other
Usenet newsgroups (comp.os.linux.hardware is a good choice; because of
the high level of traffic in these groups it helps to put the string
"sound" in the subject header for the article so the right experts
will see it)
<item>Using a web/Usenet search engine with an intelligently selected
search criteria can give very good results quickly. One such choice is
<url url="http://www.altavista.digital.com">
<item>try using the latest Linux kernel (but only as a last resort,
the latest development kernels can be unstable)
<item>send mail to the author of the sound driver
<item>send mail to the author of the Sound HOWTO
<item>fire up emacs and type <tt>Esc-x doctor</tt> :-)
</itemize>

<sect>Applications Supporting Sound<p>

I give here a sample of the types of <idx>applications</idx> that you
likely want if you have a sound card under Linux. You can check the
Linux Software Map, Internet archive sites, and/or files on your Linux
CD-ROM for more up to date information.

As a minimum, you will likely want to obtain the following sound
applications:

<itemize>
<item>audio file format conversion utility (e.g. <tt>sox</tt>)
<item>mixer utility (e.g. <tt>aumix</tt> or <tt>xmix</tt>)
<item>digitized file player/recorder (e.g. <tt>play</tt> or <tt>wavplay</tt>)
<item>MOD file player (e.g. <tt>tracker</tt>)
<item>MIDI file player (e.g. <tt>playmidi</tt>)
</itemize>

There are text-based as well as GUI-based versions of most of these
tools. There are also some more esoteric applications (e.g. speech
synthesis and recognition) that you may wish to try.

<sect>Answers To Frequently Asked Questions<p>

This section answers some of the questions that have been commonly
asked on the Usenet news groups and mailing lists.

Answers to more questions can also be found at the OSS sound
driver web page.

<sect1>What are the various sound device files?<p>

These are the most standard device file names, some Linux
distributions may use slightly different names.

<descrip>
<tag>/dev/audio</tag>normally a link to <file>/dev/audio0</file>
<tag>/dev/audio0</tag>Sun workstation compatible audio device (only
a partial implementation, does not support Sun ioctl interface, just
u-law encoding)
<tag>/dev/audio1</tag>second audio device (if supported by sound card
or if more than one sound card installed)
<tag>/dev/dsp</tag>normally a link to <file>/dev/dsp0</file>
<tag>/dev/dsp0</tag>first digital sampling device
<tag>/dev/dsp1</tag>second digital sampling device
<tag>/dev/mixer</tag>normally a link to <file>/dev/mixer0</file>
<tag>/dev/mixer0</tag>first sound mixer
<tag>/dev/mixer1</tag>second sound mixer
<tag>/dev/music</tag>high-level sequencer interface
<tag>/dev/sequencer</tag>low level MIDI, FM, and GUS access
<tag>/dev/sequencer2</tag>normally a link to <file>/dev/music</file>
<tag>/dev/midi00</tag>1st raw MIDI port
<tag>/dev/midi01</tag>2nd raw MIDI port
<tag>/dev/midi02</tag>3rd raw MIDI port
<tag>/dev/midi03</tag>4th raw MIDI port
<tag>/dev/sndstat</tag>displays sound driver status when read (also available as /proc/sound)
</descrip>

The PC speaker driver provides the following devices:

<descrip>
<tag>/dev/pcaudio</tag>equivalent to /dev/audio
<tag>/dev/pcsp</tag>equivalent to /dev/dsp
<tag>/dev/pcmixer</tag>equivalent to /dev/mixer
</descrip>

<sect1>How can I play a sound sample?<p>

Sun workstation (.au) sound files can be played by sending them to the
<file>/dev/audio</file> device. Raw samples can be sent to
<file>/dev/dsp</file>. This will generally give poor results though, and
using a program such as <tt>play</tt> is preferable, as it will
recognize most file types and set the sound card to the correct
sampling rate, etc.

Programs like wavplay or vplay (in the snd-util package) will give
best results with <idx>WAV files</idx>. However they don't recognize
Microsoft <idx>ADPCM</idx> compressed WAV files. Also older versions
of play (from the Lsox package) doesn't work well with 16 bit WAV
files.

The splay command included in the snd-util package can be used to play
most sound files if proper parameters are entered manually in the
command line.

<sect1>How can I record a sample?<p>

Reading <file>/dev/audio</file> or <file>/dev/dsp</file> will return sampled
data that can be redirected to a file. A program such as <tt>vrec</tt>
makes it easier to control the sampling rate, duration, etc. You may
also need a mixer program to select the appropriate input device.

<sect1>Can I have more than one sound card?<p>

With the current sound driver it's possible to have several
SoundBlaster, SoundBlaster/Pro, SoundBlaster16, MPU-401 or MSS cards
at the same time on the system. Installing two SoundBlasters is
possible but requires defining the macros SB2_BASE, SB2_IRQ, SB2_DMA
and (in some cases) SB2_DMA2 by editing <file>local.h</file>
manually. It's also possible to have a SoundBlaster at the same time
as a PAS16.

With the 2.0 and newer kernels that configure sound using make config,
instead of <file>local.h</file>, you need to edit the file
<file>/usr/include/linux/autoconf.h</file>. After the section
containing the lines:

<tscreen><verb>
#define SBC_BASE 0x220
#define SBC_IRQ (5)
#define SBC_DMA (1)
#define SB_DMA2 (5)
#define SB_MPU_BASE 0x0
#define SB_MPU_IRQ (-1)
</verb></tscreen>

add these lines (with values appropriate for your system):

<tscreen><verb>
#define SB2_BASE 0x330
#define SB2_IRQ (7)
#define SB2_DMA (2)
#define SB2_DMA2 (2)
</verb></tscreen>

The following drivers don't permit multiple instances:

<itemize>
<item>GUS (driver limitation)
<item>MAD16 (hardware limitation)
<item>AudioTrix Pro (hardware limitation)
<item>CS4232 (hardware limitation)
</itemize>

<sect1>Error: No such file or directory for sound devices<p>

You need to create the sound driver device files. See the section on
creating device files. If you do have the device files, ensure that
they have the correct major and minor device numbers (some older
CD-ROM distributions of Linux may not create the correct device files
during installation).

<sect1>Error: No such device for sound devices<p>

You have not booted with a kernel containing the sound driver or the
I/O address configuration doesn't match your hardware. Check that you
are running the newly compiled kernel and verify that the settings
entered when configuring the sound driver match your hardware setup.

<sect1>Error: No space left on device for sound devices<p>

This can happen if you tried to record data to <file>/dev/audio</file> or
<file>/dev/dsp</file> without creating the necessary device file. The
sound device is now a regular file, and has filled up your disk
partition. You need to run the script described in the <em>Creating
the Device Files</em> section of this document.

This may also happen with Linux 2.0 and later if there is not enough
free RAM on the system when the device is opened. The audio driver
requires at least two pages (8k) of contiguous physical RAM for each
DMA channel. This happens sometimes in machines with less than 16M of
RAM or which have been running for very long time. It may be possible
to free some RAM by compiling and running the following C program
before trying to open the device again:

<tscreen><verb>
main() {
  int i;
  char mem[500000];
  for (i = 0; i < 500000; i++)
    mem[i] = 0;
  exit(0);
}
</verb></tscreen>

<sect1>Error: Device busy for sound devices<p>

Only one process can open a given sound device at one time. Most
likely some other process is using the device in question. One way to
determine this is to use the <tt>fuser</tt> command:

<tscreen><verb>
% fuser -v /dev/dsp
/dev/dsp:             USER       PID ACCESS COMMAND
                      tranter    265 f....  tracker
</verb></tscreen>

In the above example, the <tt>fuser</tt> command showed that process
265 had the device open. Waiting for the process to complete or
killing it will allow the sound device to be accessed once again. You
should run the <tt>fuser</tt> command as root in order to report usage
by users other than yourself.

On some systems you may need to be root when running the
<tt>fuser</tt> command in order to see the processes of other users.

<sect1>I still get device busy errors!<p>

According to Brian Gough, for the SoundBlaster cards which use DMA
channel 1 there is a potential conflict with the QIC-02 tape driver,
which also uses DMA 1, causing "device busy" errors. If you are using
FTAPE, you may have this driver enabled. According to the FTAPE-HOWTO
the QIC-02 driver is not essential for the use of FTAPE; only the
QIC-117 driver is required. Reconfiguring the kernel to use QIC-117
but not QIC-02 allows FTAPE and the sound-driver to coexist.

<sect1>Partial playback of digitized sound file<p>

The symptom is usually that a sound sample plays for about a second
and then stops completely or reports an error message about "missing
IRQ" or "DMA timeout". Most likely you have incorrect IRQ or DMA
channel settings. Verify that the kernel configuration matches the
sound card jumper settings and that they do not conflict with some
other card.

Another symptom is sound samples that <em>loop</em>. This is usually
caused by an IRQ conflict.

<sect1>There are pauses when playing MOD files<p>

Playing <idx>MOD files</idx> requires considerable CPU power. You may
have too many processes running or your computer may be too slow to
play in real time. Your options are to:

<itemize>
<item>try playing with a lower sampling rate or in mono mode
<item>eliminate other processes
<item>buy a faster computer
<item>buy a more powerful sound card (e.g. Gravis UltraSound)
</itemize>

If you have a Gravis UltraSound card, you should use one of the mod
file players written specifically for the GUS (e.g. <tt>gmod</tt>).

<sect1>Compile errors when compiling sound applications<p>

The version 1.0c and earlier sound driver used a different and
incompatible <tt>ioctl()</tt> scheme. Obtain newer source code or make
the necessary changes to adapt it to the new sound driver. See the
sound driver <file>Readme</file> file for details.

Also ensure that you have used the latest version of
<file>soundcard.h</file> and <file>ultrasound.h</file> when compiling
the application. See the installation instructions at beginning of
this text.

<sect1>SEGV when running sound binaries that worked previously<p>

This is probably the same problem described in the previous question.

<sect1>What known bugs or limitations are there in the sound driver?<p>

See the files included with the sound driver kernel source.

<sect1>Where are the sound driver ioctls() etc. documented?<p>

Currently the best documentation, other than the source code, is
available at the 4Front Technologies web site, <url
url="http://www.opensound.com">. Another source of information is the
<em>Linux Multimedia Guide</em>, described in the references section.

<sect1>What CPU resources are needed to play or record without pauses?<p>

There is no easy answer to this question, as it depends on:

<itemize>
<item>whether using PCM sampling or FM synthesis
<item>sampling rate and sample size
<item>which application is used to play or record
<item>Sound Card hardware
<item>disk I/O rate, CPU clock speed, cache size, etc.
</itemize>

In general, any 386 machine or better should be able to play samples
or FM synthesized music on an 8 bit sound card with ease.

Playing MOD files, however, requires considerable CPU resources. Some
experimental measurements have shown that playing at 44kHz requires
more than 40% of the speed of a 486/50 and a 386/25 can hardly play
faster than 22 kHz (these are with an 8 bit card sound such as a
SoundBlaster). A card such as the Gravis UltraSound card performs more
functions in hardware, and will require less CPU resources.

These statements assume the computer is not performing any other CPU
intensive tasks.

Converting sound files or adding effects using a utility such as
<tt>sox</tt> is also much faster if you have a <idx>math
coprocessor</idx> (or CPU with on board FPU). The kernel driver itself
does not do any floating point calculations, though.

<sect1>Problems with a PAS16 and an Adaptec 1542 SCSI host adaptor<p>

(the following explanation was supplied by
<tt>seeker@indirect.com</tt>)

Linux only recognizes the 1542 at address 330 (default) or 334, and
the PAS only allows the MPU-401 emulation at 330. Even when you
disable the MPU-401 under software, something still wants to conflict
with the 1542 if it's at its preferred default address. Moving the
1542 to 334 makes everyone happy.<P>

Additionally, both the 1542 and the PAS-16 do 16-bit DMA, so if you
sample at 16-bit 44 KHz stereo and save the file to a SCSI drive hung
on the 1542, you're about to have trouble. The DMAs overlap and there
isn't enough time for RAM refresh, so you get the dread ``PARITY ERROR
- SYSTEM HALTED'' message, with no clue to what caused it. It's made
worse because a few second-party vendors with QIC-117 tape drives
recommend setting the bus on/off times such that the 1542 is on even
longer than normal. Get the SCSISEL.EXE program from Adaptec's BBS or
several places on the internet, and reduce the BUS ON time or increase
the BUS OFF time until the problem goes away, then move it one notch
or more further. SCSISEL changes the EEPROM settings, so it's more
permanent than a patch to the DOS driver line in CONFIG.SYS, and will
work if you boot right into Linux (unlike the DOS patch). Next
problem solved.<P>

Last problem - the older Symphony chipsets drastically reduced the
timing of the I/O cycles to speed up bus accesses. None of various
boards I've played with had <em>any</em> problem with the reduced
timing except for the PAS-16. Media Vision's BBS has SYMPFIX.EXE
that's supposed to cure the problem by twiddling a diagnostic bit in
Symphony's bus controller, but it's not a hard guarantee. You may
need to:

<itemize>
<item>get the motherboard distributor to replace the older version bus chip,
<item>replace the motherboard, or
<item>buy a different brand of sound card.
</itemize>

Young Microsystems will upgrade the boards they import for around
&dollar;30 (US); other vendors may be similar if you can figure out
who made or imported the motherboard (good luck). The problem is in
ProAudio's bus interface chip as far as I'm concerned; <em>nobody</em>
buys a &dollar;120 sound card and sticks it in a 6MHz AT. Most of
them wind up in 25-40MHz 386/486 boxes, and should be able to handle
<em>at least</em> 12MHz bus rates if the chips are designed
right. Exit soapbox (stage left).
<P>

The first problem depends on the chipset used on your motherboard,
what bus speed and other BIOS settings, and the phase of the moon.
The second problem depends on your refresh option setting (hidden or
synchronous), the 1542 DMA rate and (possibly) the bus I/O rate. The
third can be determined by calling Media Vision and asking which
flavor of Symphony chip is incompatible with their slow design. Be
warned, though - 3 of 4 techs I talked to were brain damaged. I would
be very leery of trusting <em>anything</em> they said about someone
else's hardware, since they didn't even know their own very well.<P>

<sect1>Is it possible to read and write samples simultaneously?<p>

The drivers for some sound cards support full duplex mode. Check the
documentation available from 4Front Technologies for information on
how to use it.

<sect1>My SB16 is set to IRQ 2, but configure does not allow this value.<p>

On '286 and later machines, the IRQ 2 interrupt is cascaded to the
second interrupt controller. It is equivalent to IRQ 9.

<sect1>If I run Linux, then boot DOS, I get errors and/or sound applications do not work properly.<p>

This happens after a soft reboot to DOS. Sometimes the error message
misleadingly refers to a bad <file>CONFIG.SYS</file> file.

Most of the current sound cards have software programmable IRQ and DMA
settings. If you use different settings between Linux and
MS-DOS/Windows, this may cause problems. Some sound cards don't accept
new parameters without a complete reset (i.e. cycle the power or use
the hardware reset button).

The quick solution to this problem it to perform a full reboot using
the reset button or power cycle rather than a soft reboot
(e.g. Ctrl-Alt-Del).

The correct solution is to ensure that you use the same IRQ and DMA
settings with MS-DOS and Linux (or not to use DOS :-).

<sect1>Problems running DOOM under Linux<p>

Users of the port of ID software's game <idx>DOOM</idx> for Linux may
be interested in these notes.

For correct sound output you need version 2.90 or later of the sound
driver; it has support for the real-time <tt>DOOM mode</tt>.

The sound samples are 16-bit. If you have an 8-bit sound card you can
still get sound to work using one of several programs available in
<url url="ftp://metalab.unc.edu/pub/Linux/games/doom">.

If performance of DOOM is poor on your system, disabling sound (by
renaming the file <tt>sndserver</tt>) may improve it.

By default DOOM does not support music (as in the DOS version). The
program <tt>musserver</tt> will add support for music to DOOM under
Linux. It can be found at <url
url="ftp://pandora.st.hmc.edu/pub/linux/musserver.tgz">.

<sect1>How can I reduce noise picked up by my sound card?<p>

Using good quality shielded cables and trying the sound card in
different slots may help reduce <idx>noise</idx>. If the sound card
has a volume control, you can try different settings (maximum is
probably best). Using a <idx>mixer</idx> program you can make sure
that undesired inputs (e.g. microphone) are set to zero gain.

Philipp Braunbeck reported that on his ESS-1868 sound card there was a
jumper to turn off the built-in amplifier which helped reduce noise
when enabled.

On one 386 system I found that the kernel command line option
<tt>no-hlt</tt> reduced the noise level. This tells the kernel not to
use the halt instruction when running the idle process loop. You can
try this manually when booting, or set it up using the command
<tt>append="no-hlt"</tt> in your LILO configuration file.

Some sound cards are simply not designed with good shielding and
grounding and are prone to noise pickup.

<sect1>I can play sounds, but not record.<p>

If you can play sound but not record, try these steps:

<itemize>
<item> use a mixer program to select the appropriate device (e.g. microphone)
<item> use the mixer to set the input gains to maximum
<item>If you can, try to test sound card recording under MS-DOS to
determine if there is a hardware problem
</itemize>

Sometimes a different DMA channel is used for recording than for
playback. In this case the most probable reason is that the recording
DMA is set up incorrectly.

<sect1>My "compatible" sound card only works if I first initialize under MS-DOS.<p>

In most cases a "SoundBlaster compatible" card will work better under
Linux if configured with a driver other than the SoundBlaster one.
Most sound cards claim to be compatible (e.g. "16 bit SB Pro
compatible" or "SB compatible 16 bit") but usually this SoundBlaster
mode is just a hack provided for DOS games compatibility. Most
cards have a 16 bit native mode which is likely to be supported by
recent Linux versions (2.0.1 and later).

Only with some (usually rather old) cards is it necessary to try to
get them to work in the SoundBlaster mode. The only newer cards that
are the exception to this rule are the Mwave-based cards.

<sect1>My 16-bit SoundBlaster "compatible" sound card only works in 8-bit mode under Linux.<p>

16-bit sound cards described as SoundBlaster compatible are really
only compatible with the 8-bit SoundBlaster Pro. They typically have a
16-bit mode which is not compatible with the SoundBlaster 16 and not
compatible with the Linux sound driver.

You may be able to get the card to work in 16-bit mode by using the
MAD16 or MSS/WSS driver.

<sect1>Where can I find sound applications for Linux?<p>

Here are some good archive sites to search for Linux specific sound
applications:

<itemize>
<item> <url url="ftp://metalab.unc.edu/pub/Linux/kernel/sound/">
<item> <url url="ftp://metalab.unc.edu/pub/Linux/apps/sound/">
<item> <url url="ftp://tsx-11.mit.edu/pub/linux/packages/sound/">
<item> <url url="ftp://nic.funet.fi/pub/Linux/util/sound/">
<item> <url url="ftp://nic.funet.fi/pub/Linux/xtra/snd-kit/">
<item> <url url="ftp://nic.funet.fi/pub/Linux/ALPHA/sound/">
</itemize>

Also see the References section of this document.

<sect1>Can the sound driver be compiled as a loadable module?<p>

With recent kernels the sound driver is supported as several kernel
loadable modules.

See the files in <file>/usr/src/linux/Documentation/sound</file>,
especially the files <file>Introduction</file> and
<file>README.modules</file>.

<sect1>Can I use a sound card to replace the system console beep?<p>

Try the <tt>oplbeep</tt> program, found at
<url url="ftp://metalab.unc.edu/pub/Linux/apps/sound/oplbeep-2.3.tar.gz">

Another variant is the <tt>beep</tt> program found at <url
url="ftp://metalab.unc.edu/pub/Linux/kernel/patches/misc/modreq&lowbar;beep.tgz">

The <tt>modutils</tt> package has an example program and kernel patch
that supports calling an arbitrary external program to generate sounds
when requested by the kernel.

Alternatively, with some sound cards you can connect the PC speaker
output to the sound card so that all sounds come from the sound card
speakers.

<sect1>What is VoxWare?<p>

The commercial version of the sound drivers sold by 4Front
Technologies was previously known by other names such as
<em>VoxWare</em>, <em>USS</em> (Unix Sound System), and even
<em>TASD</em> (Temporarily Anonymous Sound Driver). It is now marketed
as <em>OSS</em> (<idx>Open Sound System</idx>). The version included
in the Linux kernel is sometimes referred to as <em>OSS/Free</em>.

For more information see the 4Front Technologies web page at <url
url="http://www.opensound.com/">. I wrote a review of OSS/Linux in the
June 1997 issue of <htmlurl url="http://www.ssc.com/lj/" name="Linux
Journal">.

<sect1>Sox/Play/Vplay reports "invalid block size 1024"<p>

A change to the sound driver in version 1.3.67 broke some sound player
programs which (incorrectly) checked that the result from the
SNDCTL_DSP_GETBLKSIZE ioctl was greater than 4096. The latest sound
driver versions have been fixed to avoid allocating fragments shorter
than 4096 bytes which solves this problem with old utilities.

<sect1>The mixer settings are reset whenever I load the sound driver module<p>

You can build the sound driver as a loadable module and use
<tt>kerneld</tt> to automatically load and unload it. This can present
one problem - whenever the module is reloaded the <idx>mixer</idx>
settings go back to their default values. For some sound cards this
can be too loud (e.g. SoundBlaster16) or too quiet. Markus Gutschke
(<tt>gutschk@uni-muenster.de</tt>) found this solution. Use a line in
your <file>/etc/conf.modules</file> file such as the following:

<tscreen><verb>
options sound dma_buffsize=65536 &amp;&amp; /usr/bin/setmixer igain 0 ogain 0 vol 75
</verb></tscreen>

This causes your mixer program (in this case <tt>setmixer</tt>) to be
run immediately after the sound driver is loaded. The
<tt>dma_buffsize</tt> parameter is just a dummy value needed because
the option command requires a command line option. Change the line as
needed to match your mixer program and gain settings.

If you have compiled the sound driver into your kernel and you want to
set the mixer gains at boot time you can put a call to your mixer
program in a system startup file such as
<file>/etc/rc.d/rc.local</file>.

<sect1>Only user root can record sound<p>

By default the script in Readme.linux that creates the sound device
files only allows the devices to be read by user <tt>root</tt>. This
is to plug a potential security hole. In a networked environment,
external users could conceivably log in remotely to a Linux PC with a
sound card and microphone and eavesdrop. If you are not worried about
this, you can change the permissions used in the script.

With the default setup, users can still play sound files. This is not
a security risk but is a potential for nuisance.

<sect1>Is the sound hardware on the IBM ThinkPad supported?<p>

Information on how to use the mwave sound card on an IBM ThinkPad
laptop computer can be found in the file
<file>/usr/src/linux/Documentation/sound/mwave</file>, which is part
of the kernel source distribution.

<sect1>Applications fail because my sound card has no mixer<p>

Some old 8-bit SoundBlaster cards have no mixer circuitry. Some sound
applications insist on being able to open the mixer device, and fail
with these cards. Jens Werner (<htmlurl
url="mailto:werner@bert.emv.ing.tu-bs.de"
name="werner@bert.emv.ing.tu-bs.de">) reports a workaround for this is
to link <tt>/dev/mixer</tt> to <tt>/dev/null</tt> and everything
should work fine.

<sect1>Problems with a SB16 CT4170<p>

From Scott Manley (<htmlurl url="mailto:spm@star.arm.ac.uk"
name="spm@star.arm.ac.uk">):

<quote>
There seems to be a new type of Soundblaster - it was sold to us as a
SB16 - the Model no. on the Card is CT4170. These Beasties only have
one DMA channel so when you try to set them up then the kernel will
have trouble accessing the 16 bit DMA. The solution is to set the
second DMA to 1 so that the card will behave as advertised.
</quote>

<sect1>How to connect a MIDI keyboard to a soundcard<p>

From Kim G. S. OEyhus (<htmlurl url="mailto:kim@pvv.ntnu.no"
name="kim@pvv.ntnu.no">):

<quote>
I looked all around the internet and in sound documentation on how to
do something as simple as connecting the MIDI output from a master
keyboard to the MIDI input on a sound card. I found nothing. The
problem is that they both use the same device, /dev/midi, at least
when using the OSS sound system. So I found a way to do it, which I
want to share. This makes for a very simple synthesizer, with full
MIDI support:
</quote>

<quote>
CONNECTING A MIDI MASTER-KEYBOARD DIRECTLY TO A SOUNDCARD WITH MIDI
</quote>

<quote>
A MIDI master-keyboard is a keyboard without any synthesizer, and with
only a MIDI-out plug. This can be connected to the 15-pin D-SUB port
on most sound-cards with a suitable cable. 
</quote>

<quote>
Such a keyboard can be used to control the MIDI synthesizer device
for the card, thus making a simple keyboard controlled synthesizer.
</quote>

<quote>
Compile the following program, say with 'gcc -o prog prog.c' and run it:
</quote>

<tscreen><verb>
#include &lt;fcntl.h&gt;

main()
{
  int fil, a;
  char b[256];

  fil=open("/dev/midi", O_RDWR);
  for(;;)
    {
      a=read(fil, b, 256);
      write(fil, b, a);
    }
}
</verb></tscreen>

<sect1>Problems with IRQ 15 and Ensoniq PCI 128<p>

From Matthew Inger (<htmlurl url="mailto:mattinger@mindless.com"
name="mattinger@mindless.com">):

<quote>
Information on getting an Ensoniq PCI 128 card to work.
</quote>

<quote>
The problem that it was exhibiting was that it was trying to use
interrupt 15 by default (Plug and Pray was responsible for this one).
This interrupt is used by the secondary ide controller, and cannot be
shared by other devices. You need to somehow force the es1370 to use
another interrupt (should use interrupt 11 like it does under
windows).
</quote>

<quote>
I figured this one out for myself believe it or not.
</quote>

<quote>
What I had to do was:
</quote>

<quote>
a) in the BIOS, you have to tell the computer that you don't have
   a Plug and Play OS. I believe this is under advanced options
   in my BIOS.
</quote>

<quote>
b) in the PCI settings in the BIOS, tell the computer to reserve
   interrupt 15 for legacy ISA devices. In my bios, under advanced
   options, there is a section for PCI settings. Under there, there
   is a Resource Exclusion area, and that's where to do this.
</quote>

<quote>
When you reboot into linux you will be able to use sound. (I don't
remember if it shows up in the boot messages or not like it used to).
To be safe, I ran sndconfig again so that it would play the test message,
which sounded not great, but it was there. When I played a CD however, it
sounded perfect.
</quote>

<quote>
Don't worry about windows, I tried both my cards: ISA Modem, and the
Sound Card out, and they work without any hitches.
</quote>

<quote>
The odds are your BIOS will be different from mine, but you just have
to figure out where the settings are for the above two items. Good
luck.
</quote>

<sect1>Where can I get freely available MIDI patches to run SoftOSS?<p>

SoftOSS is a software-based wavetable synthesizer included with the
kernel sound driver that is compatible with the Gravis Utrasound
card. To operate the driver needs GUS compatible MIDI patch files. The
documentation mentions the "public domain MIDIA patchset available
from several ftp sites".

As explained on the 4Front Technologies web page <url
url="http://www.opensound.com/softoss.html"> they can be downloaded
from <url
url="ftp://archive.cs.umbc.edu/pub/midia/instruments.tar.gz">.

<sect>References<p>

If you have a sound card that supports a CD-ROM or SCSI interface, the
Linux <htmlurl
url="ftp://metalab.unc.edu/pub/Linux/docs/HOWTO/unmaintained/SCSI-HOWTO"
name="SCSI HOWTO"> and the Linux <htmlurl
url="http://metalab.unc.edu/LDP/HOWTO/CDROM-HOWTO.html" name="CD-ROM
HOWTO"> have additional information that may be useful to you.

The <htmlurl
url="http://metalab.unc.edu/LDP/HOWTO/Sound-Playing-HOWTO.html"
name="Sound Playing HOWTO"> describes how to play various types of
sound and music files under Linux.

The <htmlurl url="http://metalab.unc.edu/LDP/HOWTO/mini/Soundblaster-AWE.html"
name="Linux SoundBlaster AWE32/64 Mini-HOWTO"> describes how to get a
SoundBlaster 32 or 64 card working under Linux.

Programming information is available from the 4Front Technologies web
site at <url url="http://www.opensound.com/pguide">.

The following FAQs are regularly posted to the <idx>Usenet</idx>
newsgroup <htmlurl url="news:news.announce" name="news.announce"> as
well as being archived at <url
url="ftp://rtfm.mit.edu/pub/usenet/news.answers">:

<itemize>
<item> PCsoundcards/generic-faq (Generic PC Soundcard FAQ)
<item> PCsoundcards/soundcard-faq (comp.sys.ibm.pc.soundcard FAQ)
<item> PCsoundcards/gravis-ultrasound/faq (Gravis UltraSound FAQ)
<item> audio-fmts/part1 (Audio file format descriptions)
<item> audio-fmts/part2 (Audio file format descriptions)
</itemize>

The <idx>FAQs</idx> also list several product specific mailing lists
and archive sites. The following Usenet news groups discuss sound
and/or music related issues:

<itemize>
<item> <htmlurl url="news:alt.binaries.sounds"
name="alt.binaries.sounds.*"> (various groups for posting sound files)
<item> <htmlurl url="news:alt.binaries.multimedia"
name="alt.binaries.multimedia"> (for posting Multimedia files)
<item> <htmlurl url="news:alt.sb.programmer" name="alt.sb.programmer">
(Soundblaster programming topics)
<item> <htmlurl url="news:comp.multimedia" name="comp.multimedia">
(Multimedia topics)
<item> <htmlurl url="news:comp.music" name="comp.music"> (Computer music
theory and research)
<item> <htmlurl url="news:comp.sys.ibm.pc.soundcard"
name="comp.sys.ibm.pc.soundcard.*"> (various IBM PC sound card groups)
</itemize>

A web site dedicated to <idx>multimedia</idx> can be found at <url
url="http://viswiz.gmd.de/MultimediaInfo/">. Another good site for
Linux MIDI and sound applications is <url
url="http://sound.condorow.net/">. Creative Labs has a web site at
<url url="http://www.creaf.com/">. MediaTrix has a web site at <url
url="http://www.mediatrix.com/">.

The Linux <idx>mailing list</idx> has a number of "channels" dedicated
to different topics, including sound. To find out how to join, send a
mail message with the word "help" as the message body to <htmlurl
url="mailto:majordomo@vger.rutgers.edu"
name="majordomo@vger.rutgers.edu">. These mailing lists are not
recommended for questions on sound card setup etc., they are intended
for development related discussion.

As mentioned several times before, the kernel sound driver includes a
number of <file>Readme</file> files containing useful information about
the sound card driver. These can typically be found in the directory
<file>/usr/src/linux/drivers/sound</file>.

Information on OSS, the commercial sound driver for Linux and other
Unix compatible operating systems, can be found at the <idx>4Front
Technologies</idx> web page at <url
url="http://www.opensound.com/">.

The <em><idx>Linux Software Map</idx></em> (LSM) is an invaluable
reference for locating Linux software. Searching the LSM for keywords
such as <em>sound</em> is a good way to identify applications related
to sound hardware. The LSM can be found on various anonymous FTP
sites, including <url url="ftp://metalab.unc.edu/pub/Linux/docs/LSM/">
(formerly known as sunsite). There are also various web sites that
maintain databases of Linux applications. One such site is <url
url="http://www.freshmeat.net">.

The Linux Documentation Project has produced several <idx>books</idx>
on Linux, including <em>Linux Installation and Getting
Started</em>. These are freely available by anonymous FTP from major
Linux archive sites or can be purchased in hardcopy format.

Finally, a shameless plug: If you want to learn a lot more about
multimedia under Linux (especially CD-ROM and sound card applications
and programming), check out my book <em><idx>Linux Multimedia
Guide</idx></em>, ISBN 1-56592-219-0, published by O'Reilly and
Associates. As well as the original English version, French and
Japanese translations are now in print. For details, call 800-998-9938
in North America or check the web page <url
url="http://www.ora.com/catalog/multilinux/noframes.html"> or my home
page <url url="http://www.pobox.com/~tranter">.

</article>
