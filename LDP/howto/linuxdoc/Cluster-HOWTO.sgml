<!doctype Linuxdoc system>

<article>

<title> Linux Cluster HOWTO </title>

<author>Ram Samudrala <tt>(me@ram.org)</tt> </author>
<date> v0.3,  August 21, 2001 </date>

<abstract>
How to set up high-performance Linux computing clusters.
</abstract>

<!-- ************************************************************* -->

<toc>

<sect>  Introduction

<p> This document describes how I set up my Linux computing clusters
for high-performance computing which I need for <htmlurl
url="http://compbio.washington.edu" name="my research">. </p>

<p> Use the information below at your own risk.  I disclaim all
responsibility for anything you may do after reading this HOWTO. The
latest version of this HOWTO will always be available at <htmlurl
url="http://www.ram.org/computing/linux/linux_cluster.html"
name="http://www.ram.org/computing/linux/linux_cluster.html">. </p> 

<p> Unlike other documentation that talks about setting up clusters in
a general way, this is a specific description of how our lab is setup
and includes not only details the compute aspects, but also the
desktop, laptop, and public server aspects.  This is done mainly for
local use, but I put it up on the web since I received several e-mail
messages based on my newsgroup query requesting the same information.
The main use as it stands is that it's a report on what kind of
hardware works well with Linux and what kind of hardware doesn't. </p>

</sect>

<!-- ************************************************************* -->

<!-- ************************************************************* -->

<sect> Hardware

<p> This section covers the hardware choices I've made. Unless noted,
assume that everything works <it>really</it> well.  </p>

<p> Hardware installation is also fairly straight-forward unless
otherwise noted, with most of the details covered by the manuals. </p>

<!-- ************************************************************* -->

<sect1> Node hardware

<p> 32 machines have the following setup each: 

<itemize>
<item> 2 Pentium III 1 GHz Intel CPUs
<item> Supermicro 370 DLE Dual PIII-FCPGA motherboard
<item> 2 256 MB 168-pin PC133 Registered ECC Micron RAM
<item> 1 20 GB Maxtor ATA/66 5400 RPM HD
<item> 1 40 GB Maxtor UDMA/100 7200 RPM HD
<item> Asus CD-S500 50x CDROM
<item> 1.4 MB floppy drive
<item> ATI Expert 98 8 MB PCI video card
<item> Mid-tower case
</itemize>
</p>

</sect1>

<!-- ************************************************************* -->

<sect1> Server hardware

<p> 1 external server with the following setup: 

<itemize>
<item> 2 Pentium III 1 GHz Intel CPUs
<item> Supermicro 370 DLE Dual PIII-FCPGA motherboard
<item> 2 256 MB 168-pin PC133 Registered ECC Micron RAM
<item> 1 20 GB Maxtor ATA/66 5400 RPM HD
<item> 2 40 GB Maxtor UDMA/100 7200 RPM HD
<item> Asus CD-S500 50x CDROM
<item> 1.4 MB floppy drive
<item> ATI Expert 98 8 MB PCI video card
<item> Full-tower case
</itemize>
</p>

</sect1>

<!-- ************************************************************* -->

<sect1> Desktop hardware

<p> 4 desktops with the following setup: 

<itemize>
<item> 2 Pentium III 1 GHz Intel CPUs
<item> Supermicro 370 DE6 Dual PIII-FCPGA motherboard
<item> 4 256 MB 168-pin PC133 Registered ECC Micron RAM
<item> 3 40 GB Maxtor UDMA/100 7200 RPM HD
<item> Ricoh 32x12x10 CDRW/DVD Combo EIDE
<item> 1.4 MB floppy drive
<item> Asus V7700 64mb GeForce2-GTS AGP video card
<item> Creative SB Live Platinum 5.1 sound card
<item> Microsoft Natural Keyboard
<item> Microsoft Intellimouse Explorer
<item> Full-tower case
</itemize>
</p>

<p> 2 desktops with the following setup:

<itemize>
<item> 2 Pentium III 1 GHz Intel CPUs
<item> Supermicro 370 DLE Dual PIII-FCPGA motherboard
<item> 4 256 MB 168-pin PC133 Registered ECC Micron RAM
<item> 3 40 GB Maxtor UDMA/100 7200 RPM HD
<item> Mitsumi 8x/4x/32x CDRW
<item> 1.4 MB floppy drive
<item> Jaton Nvidia TNT2 32mb PCI
<item> Creative SB LIVE Value PCI
<item> Microsoft Natural Keyboard
<item> Microsoft Intellimouse Explorer
<item> Full-tower case
</itemize> 
</p>

<p> 2 desktops with the following setup:

<itemize>
<item> 2 Pentium III 1 GHz Intel CPUs
<item> Supermicro 370 DLE Dual PIII-FCPGA motherboard
<item> 4 256 MB 168-pin PC133 Registered ECC Micron RAM
<item> 3 40 GB Maxtor UDMA/100 7200 RPM HD
<item> Asus CD-S500 50x CDROM
<item> 1.4 MB floppy drive
<item> Jaton Nvidia TNT2 32mb PCI
<item> Creative SB LIVE Value PCI
<item> Microsoft Natural Keyboard
<item> Microsoft Intellimouse Explorer
<item> Full-tower case
</itemize> 
</p>

<p> Backup: 

<itemize>
<item> 2 Sony 20/40 GB DSS4 SE LVD DAT
</itemize>
</p>

<p> Monitors: 

<itemize>
<item> 4 21" Sony CPD-G500 .24mm monitor
<item> 2 18" Viewsonic VP-181 TFT-LCD monitor
</itemize>
</p>

</sect1>

<!-- ************************************************************* -->

<sect1> Putting-it-all-together hardware

<p> We use KVM switches with a cheap monitor to connect up and "look"
at all the machines:

<itemize>
<item> 15" .28dp XLN CTL Monitor
<item> 3 Belkin Omniview 16-Port Pro Switches
<item> 40 KVM cables
</itemize>
</p>

<p> While this is a nice solution, I think it's kind of needless. What
we need is a small hand held monitor that can plug into the back of
the PC (operated with a stylus, like the Palm). I don't plan to use
more monitor switches/KVM cables. </p>

<p> Networking is important:

<itemize>
<item> 1 Cisco Catalyst 3448 XL Enterprise Edition network switch.
</itemize>
</p>

</sect1>

<!-- ************************************************************* -->

<sect1> Costs

<p> Our vendor is Hard Drives Northwest (<htmlurl
url="http://www.hdnw.com" name="http://www.hdnw.com">). For each
compute node in our cluster (containing two processors), we paid about
$1500, including taxes. Generally, our goal is to keep each node to
below $2000.00 (which is what our desktop machines cost). </p>

</sect1> 

<!-- ************************************************************* -->

</sect>

<!-- ************************************************************* -->

<sect> Software

<!-- ************************************************************* -->

<sect1> Linux, of course!

<p> Specfically we use 2.2.17-14 kernel based on the KRUD 7.0
distribution. We use our own software for parallising applications but
have experimented with PVM and MPI. In my view, the overhead for these
pre-packaged programs is too high. </p>

</sect1>

<!-- ************************************************************* -->

<sect1> Costs

<p> Linux is freely copiable. </p>

</sect1>

<!-- ************************************************************* -->

</sect>

<!-- ************************************************************* -->

<sect> Set up and configuration

<!-- ************************************************************* -->

<sect1> Disk configuration

<p> This section describes disk partitioning strategies. </p> 

<p>
<tscreen><verb>
farm/cluster machines:

hda1 - swap  (2 * RAM)
hda2 - /     (remaining disk space)
hdb1 - /maxa (total disk)

desktops (without windows):

hda1 - swap  (2 * RAM)
hda2 - /     (4 GB)
hda3 - /home (remaining disk space)
hdb1 - /maxa (total disk)
hdd1 - /maxb (total disk)

desktops (with windows):

hda1 - /win  (total disk)
hdb1 - swap  (2 * RAM)
hdb2 - /     (4 GB)
hdb3 - /home (remaining disk space)
hdd1 - /maxa (total disk)

laptops (single disk):

hda1 - /win  (half the total disk size)
hda2 - swap  (2 * RAM)
hda3 - /     (4 GB)
hda4 - /home (remaining disk space)
</verb></tscreen>
</p>

</sect1>

<!-- ************************************************************* -->

<sect1> Package configuration 

<p> Install a minimal set of packages for the farm. Users are allowed
to configure desktops as they wish.  </p>

</sect1>

<!-- ************************************************************* -->

<sect1> Operating system installation

<!-- ************************************************************* -->

<sect2> Cloning 

<p> I believe in having a completely distributed system. This means
each machine contains a copy of the operating system.  Installing the
OS on each machine manually is cumbersome. To optimise this process,
what I do is first set up and install one machine exactly the way I
want to.  I then create a tar and gzipped file of the entire system
and place it on a CD-ROM which I then clone on each machine in my
cluster. </p>

<p> The commands I use to create the tar file are as follows: 

<tscreen><verb>
tar -czvlps --same-owner --atime-preserve -f /maxa/slash.tgz /
</verb></tscreen>
</p>

<p> I use have a script called <tt>go</tt> that takes a hostname and
IP address as its arguments and untars the <tt>slash.tgz</tt> file on
the CD-ROM and replaces the hostname and IP address in the appropriate
locations. A version of the <tt>go</tt> script and the input files for
it can be accessed at: <htmlurl
url="http://www.ram.org/computing/linux/cluster/"
name="http://www.ram.org/computing/linux/linux/cluster/">. This script
will have to be edited based on your cluster design. </p>

<p> To make this work, I also use Tom's Root Boot package <htmlurl
url="http://www.toms.net/rb/" name="http://www.toms.net/rb/"> to boot
the machine and clone the system.  The <tt>go</tt> script can be
placed on a CD-ROM or on the floppy containing Tom's Root Boot package
(you need to delete a few programs from this package since the floppy
disk is stretched to capacity). </p>

<p> More conveniently, you could burn a bootable CD-ROM containing
Tom's Root Boot package, including the <tt>go</tt> script, and the tgz
file containing the system you wish to clone.  You can also edit Tom's
Root Boot's init scripts so that it directly executes the <tt>go</tt>
script (you will still have to set IP addresses if you don't use
DHCP). </p>

<p> Thus you can develop a system where all you have to do is insert a
CDROM, turn on the machine, have a cup of coffee (or a can of coke)
and come back to see a full clone. You then repeat this process for as
many machines as you have. This procedure has worked extremely well
for me and if you have someone else actually doing the work (of
inserting and removing CD-ROMs) then it's ideal. </p>

</sect2>

<!-- ************************************************************* -->

<sect2> DHCP vs. hard-coded IP addresses

<p> If you have DHCP set up, then you don't need to reset the IP
address and that part of it can be removed from the <tt>go</tt>
script. </p>

<p> DHCP has the advantage that you don't muck around with IP
addresses at all provided the DHCP server is configured
appropriately. It has the disadvantage that it relies on a centralised
server (and like I said, I tend to distribute things as much as
possible). Also, linking hardware ethernet addresses to IP addresses can
make it inconvenient if you wish to replace machines or change
hostnames routinely. </p>

</sect2>

<!-- ************************************************************* -->

</sect1>

<!-- ************************************************************* -->

</sect>

<!-- ************************************************************* -->

<sect> Performing tasks on the cluster

<p> This section is still being developed as the usage on my cluster
evolves, but so far we tend to write our own sets of message passing
routines to communicate between processes on different machines.  </p>

<p> Many applications, particularly in the computational genomics
areas, are massively and trivially parallelisable, meaning that
perfect distribution can be achieved by spreading tasks equally across
the machines (for example, when analysing a whole genome using a
single gene technique, each processor can work on one gene at a time
independent of all the other processors). </p>

<p> So far we have not found the need to use a professional queing
system, but obviously that is highly dependent on the type of
applications you wish to run. </p>

</sect>

<!-- ************************************************************* -->

<sect> Acknowledgements 

<p> The following people have been helpful in getting this HOWTO
done: 

<itemize>
<item> Michael Levitt (<htmlurl url="mailto:michael.levitt@stanford.edu" name="Michael Levitt">)
</itemize>
</p>

</sect>

<!-- ************************************************************* -->

<sect> Bibliography <label id="references">

<p> The following documents may prove useful to you---they are links
to sources that make use of high-performance computing clusters:

<itemize>
<item> <url url="http://www.ram.org/computing/rambin/rambin.html"
name="RAMBIN web page">

<item> <url url="http://www.ram.org/computing/ramp/ramp.html"
name="RAMP web page">

<item> <url url="http://www.ram.org/research/research.html" name="Ram
Samudrala's research page (which describes the kind of research done with these clusters)">
</itemize>
</p>

</sect>

<!-- ************************************************************* -->

</article>
