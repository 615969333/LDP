<!DOCTYPE Article PUBLIC "-//OASIS//DTD DocBook V3.1//EN">

<!--
Changelog:
	081800: Began work on version 1.00 of CD Server HOWTO - Randy Tata
	090100: Conversion to linuxdoc SGML from text/html
	092300: Conversion from linuxdoc to DocBook - Randy Tata
-->

<Article>

<ArtHeader>

<Title>CDServer-HOWTO</Title>
<AUTHOR>
	<FirstName>Randolph</FirstName>
	<surname>Tata</surname>
	<affiliation>
		<address>
			<email>randy@talcon.com</email>
		</address>
	</affiliation>
</AUTHOR>

<pubdate>v1.00, 23 September 2000</pubdate>

<revhistory>

	<revision>
		<revnumber>v1.00</revnumber>
		<date>23 September 2000</date>
		<authorinitials>rjt</authorinitials>
		<revremark>
			Conversion from linuxdoc sgml to DocBook v3.1
		</revremark>
	</revision>

	<revision>
		<revnumber>v0.10</revnumber>
		<date>1 September 2000</date>
		<authorinitials>rjt</authorinitials>
		<revremark>	
			Conversion to linuxdoc sgml from text/html
		</revremark>
	</revision>

	<revision>
		<revnumber>v0.01</revnumber>
		<date>18 August 2000</date>
		<authorinitials>rjt</authorinitials>
		<revremark>	
			First version released in text and html.  Still need to
			add section on kernel modifications and creating more
			loop devices.
		</revremark>
	</revision>
</revhistory>

<Abstract>
	<indexterm>
		<primary>cdserver</primary>
	</indexterm>

	<Para>
	The CD Server HOWTO describes the steps and commands you can 
	use to setup your own CD Server using Linux and some built-in 
	Unix commands along with other freely available software packages.  
	The CD Server can then share the CD's via the network to 
	Windows and/or other client machines.
	</Para>

</Abstract>

</ArtHeader>

<!-- Section1: intro -->

<Sect1 id="introduction">
<Title>Introduction</Title>

<indexterm>
	<primary>cdserver!introduction</primary>
</indexterm>

<Para>
With disk space becoming less expensive (30GB IBM 7200rpm for $160 in 
08/2000), it is now viable to use an Open Source software-based CD 
Server solution, instead of paying $800-$4,000 for a software, thin-server, 
or CD Jukebox solution.
</Para>

<Para>
I've setup my CD Server on a P120 with 64MB RAM, using one of these 
large drives.
</Para>

<!-- Section2: Intended Audience -->

<Sect2 id="audience">
<Title>Intended Audience</Title>

<Para>
This HOWTO is specifically directed toward System Administrators 
and uses Linux for the examples.  It should work with other flavors of 
Unix provided that they have a loop device or a method of mounting a 
CD image file within the directory tree as a block device using the 
iso9660 file system. 
</Para>

</Sect2>

<!-- Section2: Things Needed -->

<Sect2 id="needed">
<Title>Things You'll Need</Title>

<indexterm>
	<primary>cdserver!utilities needed</primary>
</indexterm>

<Para>
The commands and utilities needed to setup your own CD Server
are already included in most (if not all) Linux distributions.
</Para>

<Para>

<ItemizedList>

<ListItem>
<Para>
Linux Distribution (This HOWTO uses 
<ULink URL="http://www.linux-mandrake.com/">
Linux-Mandrake</ULink> for the examples)
</Para>
</ListItem>

<ListItem>
<Para>
dd - Converts and copies a file (a standard Unix command)
</Para>
</ListItem>

<ListItem>
<Para>
mount - Mounts and Unmounts filesystems (a standard Unix command)
</Para>
</ListItem>

<ListItem>
<Para>
<ULink URL="http://www.samba.org/">Samba</ULink> - A Windows SMB/CIFS fileserver for Unix
</Para>
</ListItem>

<ListItem>
<Para>
NFS (optional) - Network File System (usually included in Linux distributions)
</Para>
</ListItem>

</ItemizedList>

</Para>

<Para>
<VariableList>

<VarListEntry>
<Term>Caveats</Term>
<ListItem>
<Para>
The Linux-Mandrake distribution I'm using (7.0), only has
support for 8 loop devices compiled into the kernel (see 
<XRef LinkEnd="kerneltweak"> 
to increase this number).
In short, you'll only be able to share 8 CD's on a network at most 
with this default value, to share more than 8, you'll need to do a 
little more work.
</Para>
</listitem>
</VarListEntry>
</VariableList>
</Para>

</Sect2>

<!-- Section2: Suggested Reading -->

<Sect2 id="reading">
<Title>Suggested Reading</Title>

<Para>
<ULink URL="http://www.oreilly.com/catalog/samba/">
<citetitle>Using Samba</citetitle></ULink>
by:  Robert Eckstein, David Collier-Brown, Peter Kelly
1st Edition November 1999, O'Reilly and Associates, Inc.
ISBN 1-56592-449-5,
</Para>

</Sect2>

<!-- Section2: Copyright -->
<!--
<em> This HOWTO is copyrighted 2000 Randolph Tata.</em>

Unless otherwise stated, Linux HOWTO documents are copyrighted by their
respective authors. Linux HOWTO documents may be reproduced and distributed
in whole or in part, in any medium physical or electronic, as long as
this copyright notice is retained on all copies. Commercial redistribution
is allowed and encouraged; however, the author would like to be notified of
any such distributions.

All translations, derivative works, or aggregate works incorporating
any Linux HOWTO documents must be covered under this copyright notice.
That is, you may not produce a derivative work from a HOWTO and impose
additional restrictions on its distribution. Exceptions to these rules
may be granted under certain conditions; please contact the Linux HOWTO
coordinator at the address given below.

In short, we wish to promote dissemination of this information through as
many channels as possible. However, we do wish to retain copyright on the
HOWTO documents, and would like to be notified of any plans to redistribute
the HOWTOs.

If you have questions, please contact
at linux-howto@metalab.unc.edu via email.
-->

<Sect2 id="copyright">
<Title>Copyright</Title>

<indexterm>
	<primary>cdserver!copyright</primary>
</indexterm>

<Para>
<Emphasis>CDServer-HOWTO, Copyright (c) 2000, Randolph Tata, All Rights Reserved</Emphasis>
</Para>

<Para>
Please freely copy and distribute (sell or give away) this document in
any format.  It's requested that corrections and/or comments be fowarded
to the document maintainer
(<ULink URL="mailto:randy@talcon.com">Randolph Tata</ULink>).
You may create a derivative work and distribute it provided that you:
</Para>

<Para>

<ItemizedList>
<ListItem>

<Para>
Send your derivative work (in the most suitable format such as
sgml) to the LDP (<ulink url="http://www.linuxdoc.org/">
Linux Documentation Project</ulink>) or the like for posting
on the Internet.  If not the LDP, then let the LDP know where it is
available.
</Para>
</ListItem>
<ListItem>

<Para>
License the derivative work with this same license or use GPL.
Include a copyright notice and at least a pointer to the license used.
</Para>
</ListItem>
<ListItem>

<Para>
Give due credit to previous authors and major contributors.
</Para>
</ListItem>

</ItemizedList>

</Para>

<Para>
If you're considering making a derived work other than a translation,
it's requested that you discuss your plans with the current maintainer.
</Para>

</Sect2>

<!-- Section2: Disclaimer -->

<Sect2 id="disclaimer">
<Title>Disclaimer</Title>

<Para>
Use the information in this document at your own risk. I disavow any
potential liability for the contents of this document. Use of the
concepts, examples, and/or other content of this document is entirely
at your own risk.
</Para>

<Para>
All copyrights are owned by their owners, unless specifically noted
otherwise.  Use of a term in this document should not be regarded as
affecting the validity of any trademark or service mark.
</Para>

<Para>
Naming of particular products or brands should not be seen as endorsements.
</Para>

<Para>
You are strongly recommended to make a backup of your system before
major installation and should make backups at regular intervals.
</Para>
</Sect2>

<!-- Section2: News -->

<Sect2 id="news">
<Title>News</Title>

<indexterm>
	<primary>cdserver!recent news</primary>
</indexterm>

<Para>
This is the first sgml release (version 1.00).  <ulink url="CDServer-HOWTO.sgml">SGML source
</ulink> for this document is available.  Any additions/changes should be made
to the sgml source, not derivative formats.
</para>

<Para>
<Emphasis>This documents home page is at the
<ULink URL="http://talcon.com/opencdserver/">Open CD Server Project</ULink>
site page in case you need the latest version, or there is a problem 
with the page format you are viewing.</Emphasis>
</Para>

<Para>
<Emphasis>If you have the capacity it would be nice to make the CDServer-HOWTO
available in a number of formats and languages.</Emphasis>
</Para>

</Sect2>

<!-- Section2: Credits -->

<Sect2 id="credits">
<Title>Credits</Title>

<Para>
In this version I have the pleasure of acknowledging
</Para>

<Para>

<Screen>
Mark F. Komarinski    markk (at) linuxdoc.org         LDP Author Guide
Jorge Godoy           godoy (at) metalab.unc.edu      LDP Author Guide
David C. Merrill      dcmerrill (at) mindspring.com   LDP Author Guide
Stein Gjoen           sgjoen (at) nyx.net             HOWTO-Template
Gregory Leblanc       gleblanc (at) cu-portland.edu   HOWTO-Template
Greg Ferguson         gferg (at) sgi.com              HOWTO-Template
</Screen>

</Para>

</Sect2>

<!-- Section2: Translations -->

<Sect2 id="translations">
<Title>Translations</Title>

<Para>
No Translations yet.
</Para>

<Para>
Any comments or suggestions can be mailed to my 
email address at <ulink url="http://www.talcon.com/">
Talcon Information Systems</ulink>: <email>randy@talcon.com</email>.
</Para>

</Sect2>

</Sect1>

<!-- Section1: Procedure -->

<Sect1 id="procedure">
<Title>Procedure</Title>

<para>
<emphasis>Summary of Steps</emphasis>
</para>

<indexterm>
	<primary>cdserver!procedure</primary>
</indexterm>

<ItemizedList>

<ListItem>
<Para>
Create a large partition to hold the CD Image Files.
</Para>
</ListItem>

<ListItem>
<Para>
Copy the CD to an image file using the "dd" command.
</Para>
</ListItem>

<ListItem>
<Para>
Mount the CD image file within the directory tree.
</Para>
</ListItem>

<ListItem>
<Para>
Share the directory on the network using Samba, NFS, etc.
</Para>
</ListItem>

</ItemizedList>

<!-- Section2: Creating Images -->

<Sect2 id="createimage">
<Title>Creating the ISO Images</Title>

<indexterm>
	<primary>cdserver!creating images</primary>
</indexterm>

<Para>
Choose (or create) a file system with the largest available disk
space on it.  Keep in mind that CD-ROM's can hold around 640MB of data,
so if you want to share 8 full CD's on your network,
you'll need 5.1GB of space available.
</Para>

<Para>

<Screen>
Login as root or "su" to root.

bash# df -h

Filesystem            Size  Used Avail Use% Mounted on
/dev/hda5             1.4G   82M  1.3G   6% /
/dev/hda1              15M  827k   14M   6% /boot
/dev/hda7             2.4G 1008M  1.3G  43% /usr
/dev/hda8            23.6G 11.7G 11.7G  50% /home
</Screen>

</Para>

<Para>
Here the /home filesystem has the most available space, so it is the 
most suitable filesystem to use for dumping the CD images to.
</Para>

<Para>

<Screen>
 
bash# cd /home
bash# mkdir image
bash# cd image
</Screen>
 
</Para>

<Para>
Now, copy the CD to an iso image.  You must know the device name 
of your CD-ROM drive (usually /dev/cdrom, it could be /dev/scd0 for 
SCSI CD-ROM's) I'll use the Mandrake distribution CD-ROM as an Example:
</Para>

<Para>

<Screen>
bash# dd if=/dev/cdrom of=mndrk71.iso
</Screen>

</Para>

<Para>
The "if=" is the input file, the "of=" is the output file.  You 
should see a message stating the number of records in and number of 
records out (hopefully with no i/o errors).
</Para>

</Sect2>

<!-- Section2: Mounting Images -->

<Sect2 id="mountimage">
<Title>Mounting the ISO Images</Title>

<indexterm>
	<primary>cdserver!mounting images</primary>
</indexterm>

<Para>
The next step is to mount the iso image file.  Let's create 
a directory under /mnt to place the mounted file.
</Para>

<Para>

<Screen>
bash# cd /mnt
bash# mkdir iso
bash# cd iso
bash# mkdir mndrk71
</Screen>

</Para>

<Para>
Now mount the ISO image file to this newly created directory
</Para>

<Para>

<Screen>
bash# mount -o loop -t iso9660 -r /home/image/mndrk71.iso /mnt/iso/mndrk71
</Screen>

</Para>

<Para>
The "-o loop" means use the option that mounts a file as a block 
device.  The "-t iso9660" means that the file is in the iso9660 CD-ROM 
format.  The "-r" means to mount read-only.
</Para>

<Para>
Now you can:
</Para>

<Para>

<Screen>
bash# cd mndrk71
bash# ls -al
</Screen>

</Para>

<Para>
You should see a listing (ls) of the files and directories that are on 
the actual CD (only now they're inside the iso image file, and that's 
what you're currently looking at!)
</Para>

</Sect2>

<!-- Section2: System Restart -->

<Sect2 id="systemrestart">
<Title>Mounting the Image upon System Restart</Title>

<indexterm>
	<primary>cdserver!editing fstab</primary>
</indexterm>

<Para>
Now that we've manually mounted the image, and made sure it works, 
an entry needs to made in the /etc/fstab file so that the image is 
remounted on the next system startup.  It's important to make the 
entry AFTER the entry for the parent filesystem, e.g. /home (I 
use vim, but Emacs, Joe, Pico or Jed will work just as well):
</Para>

<Para>
<Screen>
bash# vim /etc/fstab
</Screen>
</Para>

<Para>
After the line that looks like the following (or whichever filesystem you've placed your images):
</Para>

<Para>
<Screen>
/dev/hda8 /home ext2 defaults 1 2
</Screen>
</Para>

<Para>
Insert the following line with your text editor:
</Para>

<Para>
<Screen>
/home/image/mndrk71.iso /mnt/iso/mndrk71 iso9660 ro,loop,auto 0 0
</Screen>
</Para>

</Sect2>

<!-- Section2: Sharing -->

<Sect2 id="sharing">
<Title>Sharing it on a Windows Network using Samba</Title>

<indexterm>
	<primary>cdserver!network sharing</primary>
</indexterm>

<Para>
You'll need to have Samba installed and working to perform the next 
steps (that's outside the scope of this instruction).  If it's not 
yet installed, consult your Linux distribution's instructions for 
installing the Samba package.  Or you can visit the Samba website 
at http://us1.samba.org/samba/samba.html for installation instructions, 
binaries, and/or the source code.
</Para>

<Para>
To share your mounted CD's on a windows network, simply create 
a stanza in the /etc/smb.conf file similar to the following:
</Para>

<Para>
<Screen>
[cdimages]
  comment = All Shared CD Images
  path = /mnt/iso
  public = yes
  writable = no
</Screen>
</Para>

<Para>
This will share all the subdirectories under the /mnt/iso directory 
on the network.  To mount the share to a local drive (in this case 
the I: drive), bring up an MS-DOS Prompt on the Windows machine and 
type the following:
</Para>

<Para>
<Screen>
C:\&#62; net use I: \\yourlinuxmachine\cdimages
</Screen>
</Para>

<Para>
Each CD image will now appear as a subdirectory on the I: drive of 
your Windows machine.
</Para>

<Para>
To mount ONLY the Mandrake CD image to a drive letter (we'll use M:, 
the root drive of which, will correspond exactly to the CD as if it 
was just inserted in the CD-ROM drive), create the following stanza 
in the /etc/smb.conf file.
</Para>

<Para>
<Screen>
[mndrk71]
  comment = Mandrake Linux 7.1
  path = /mnt/iso/mndrk71
  public = yes
  writable = no
</Screen>
</Para>

<Para>
Then, at your MS-DOS Prompt, mount it with the following command:
</Para>

<Para>
<Screen>
C:\&#62; net use m: \\yourlinuxmachine\mndrk71
</Screen>
</Para>

<Para>
<VariableList>

<VarListEntry>
<Term>Note:</Term>
<ListItem>
<Para>
The Samba smb.conf file stanzas presented here are 
simplified, and not entirely secure.  Many more options exist for 
a Samba share which limit who can mount the shares, control how 
user authentication is performed, whether the share is even 
browseable through Network Neighborhood on the Windows machines.
</Para>
</listitem>
</VarListEntry>
</VariableList>
</Para>

</Sect2>

<!-- Section2: NFS -->

<Sect2 id="nfs">
<Title>Sharing the Images on a Unix network using NFS</Title>

<indexterm>
	<primary>cdserver!nfs sharing</primary>
</indexterm>

<Para>
Make sure that NFS is running and configured correctly on 
your Linux machine, then add the following to the /etc/exports 
file using your own preferred options:
</Para>

<Para>
<Screen>
# sample /etc/exports file
       /mnt/iso            (ro,insecure,all_squash)
</Screen>
</Para>

<Para>
Now, when typing "showmount -e yourlinuxmachine" you should see 
that the /mnt/iso is included in the exports list.
</Para>

</Sect2>

</Sect1>

<!-- Section1: Kernel Tweaking -->

<Sect1 id="kerneltweak">
<Title>Adding Support for More Loop Devices </Title>

<indexterm>
	<primary>cdserver!kernel tweaking</primary>
</indexterm>

<Para>
The Linux-Mandrake distribution I'm using (7.0), only has
support for 8 loop devices compiled into the kernel.  In short, you'll
only be able to share 8 CD's on a network with this default value.
To support more than the default, you'll need to follow this section.
If you're new to Linux, you've going to learn some cool things by
accomplishing this.
</Para>

<!-- Section2: Edit Kernel -->

<Sect2 id="editkernel">
<Title>Tweaking the Kernel</Title>

<Para>
To increase the number of loop devices supported by the kernel, you'll
need to edit the /usr/src/linux/drivers/block/loop.c file.
</Para>

<Para>
<Emphasis>If you find that the kernel sources are not installed on your machine, 
you'll need to consult your Linux Distribution's documentation on 
how to install them (the Kernel Sources come with all distributions - 
it's part of the GPL licensing).</Emphasis>
</Para>

<Para>
Change the number in the following line to however many loop devices
you'll need.
</Para>

<Para>
<Screen>
#define MAX_LOOP 16
</Screen>
</Para>

<Para>
Compile the new kernel or module as the case may be.  If you need some
help getting started with this, read /usr/src/linux/README.
</Para>

</Sect2>

<!-- Section2: Loop Devices -->

<Sect2 id="loopdev">
<Title>Creating the Loop Devices in /dev</Title>

<indexterm>
	<primary>cdserver!creating loop devices</primary>
</indexterm>

<Para>
The mknod command creates the devices in /dev.  The loop devices have a major
number of "7", and the minor numbers begin at "0".  If your MAX&lowbar;LOOP was defined
as 8 in /usr/src/linux/drivers/block/loop.c, you should have loop0 thru loop7
in /dev.  To create the /dev/loop8 device, use the following command (subsitute
the appropriate number for the "8" in the example below).
</Para>

<Para>
<Screen>
mknod -m660 /dev/loop8 b 7 8
</Screen>
</Para>

<Para>
Check Owner/Group &#38; Permissions on the new file.  You can change the owner
and group with the following command:
</Para>

<Para>
<Screen>
chown root.disk /dev/loop8
</Screen>
</Para>

<Para>
You can change the permissions using the following command:
</Para>

<Para>
<Screen>
chmod 666 /dev/loop8
</Screen>
</Para>

</Sect2>

</Sect1>

</Article>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:nil
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
