<?xml version='1.0' encoding='UTF-8'?>
<chapter id="chap_08">
<title>Printers and printing</title>
<abstract>
<para>In this chapter we will learn more about printers and printing files.  After reading this part, you will be able to:</para>
<para>
<itemizedlist>
<listitem><para>Format documents</para></listitem>
<listitem><para>Preview documents before sending them to the printer</para></listitem>
<listitem><para>Choose a good printer that works with your Linux system</para></listitem>
<listitem><para>Print files and check on printer status</para></listitem>
<listitem><para>Troubleshoot printing problems</para></listitem>
<listitem><para>Find necessary documentation to install a printer</para></listitem>
</itemizedlist>
</para>
</abstract>
<sect1 id="sect_08_01"><title>Printing files</title>
<sect2 id="sect_08_01_01"><title>General</title>
<para>RedHat ships with LPRng, an improved version of the well-known UNIX print system.  If the printer has been set up, all you need to do is learn how to use <command>lpr</command> to send files to the printer, which basically comes down to</para>

<cmdsynopsis><command>lpr <filename>file(s)</filename></command></cmdsynopsis>

<para><command>Lpr</command> uses a spooling daemon, <command>lpd</command> to print the named files when facilities become available.  If no names appear, standard input is assumed (such as when the output of a command is piped into <command>lpr</command>).  The <command>lpr</command> command has a lot of options, which can be displayed using the <option>--help</option> option.  Full information is in the Info pages.  You will also find the <command>lp</command> command on your Linux system, for compatibility reasons with other (UNIX) programs.  You will find that <command>lp</command> is in fact a symbolic link to <command>lpr</command>:</para>
<screen>
<prompt>davy:~&gt;</prompt> <command>ls -l /usr/bin/lp*</command>
lrwxrwxrwx  1 root    root        3 Oct 28 14:21 /usr/bin/lp -> lpr
-rwxr-xr-x  1 lp      lp     395192 Aug 11  2001 /usr/bin/lpq
-rwxr-xr-x  1 lp      lp     408536 Aug 11  2001 /usr/bin/lpr
-rwxr-xr-x  1 lp      lp     392984 Aug 11  2001 /usr/bin/lprm
-rwxr-xr-x  1 root    root     4651 Oct 19 22:17 /usr/bin/lprsetup.sh
-rwxr-xr-x  1 lp      lp     398488 Aug 11  2001 /usr/bin/lpstat
<prompt>davy:~&gt;</prompt> <command>ps -ef | grep lpd</command>
lp        1003     1  0 Feb22 ?        00:00:00 lpd Waiting
</screen>
<para>Once the file is accepted in the print queue, an identification number for the print job is assigned:</para>

<screen>
<prompt>davy:~&gt;</prompt> <command>lp /etc/profile</command>
request id is davy@blob+253
</screen>
<para>To view (query) the print queue, use the <command>lpq</command> command.  When entered without arguments, it displays the contents of the default print queue.</para>
<screen>
<prompt>davy:~&gt;</prompt> <command>lpq</command>
Printer: lp@blob
 Queue: no printable jobs in queue
 Status: job 'cfA284blob.somewhere.org' removed at 11:02:47.098
</screen>
<para>If you don't like what you see, use <command>lprm</command> to delete jobs.  Use <command>lprm <parameter>-</parameter></command> to delete all jobs which you submitted.  If you only want to cancel one job, use the number of that job as an argument to <command>lprm</command>.</para>
<para>In larger environments, <command>lpc</command> may be used to control multiple printers.  See the Info on each command.</para>

<para>There are many GUI print tools used as a front-end to <command>lpr</command>, and most graphical applications have a print function that uses <command>lpr</command>.  See the built-in Help functions and program specific documentation for more.</para>
</sect2>
<sect2 id="sect_08_01_02"><title>Formatting</title>
<sect3 id="sect_08_01_02_01"><title>Tools</title>
<para>If we want to get something sensible out of the printer, files should be formatted first.  Apart from an abundance of formatting software, Linux comes with the basic UNIX formatting tools and languages.</para>

<para>Most markup languages are more suitable for large or repetitive jobs, where the computer controls the layout of the text, like when executing scripts.</para>
<itemizedlist>
<listitem><para><command>groff</command>: GNU version of the UNIX <command>roff</command> command.  It is a front-end to the groff document formatting system.  Normally it runs the <command>troff</command> command and a post-processor appropriate for the selected device.  It allows generation of PostScript files.</para></listitem>
<listitem><para><emphasis>TeX</emphasis> and the macro package <emphasis>LaTeX</emphasis>: one of the most widely used markup languages on UNIX systems.  Usually invoked as <command>tex</command>, it formats files and outputs a corresponding device-independent representation of the typeset document.</para>
<para>Technical works are <emphasis>still</emphasis> frequently written in LaTeX because of its support for mathematic formulas, although efforts are being made at <ulink url="http://www.w3.org">W3C</ulink> (the World Wide Web Consortium) to include this feature in other applications.</para></listitem>
<listitem><para>SGML and XML: Free parsers are available for UNIX and Linux.  XML is the next generation SGML, it forms the basis for DocBook XML, a document system (this book is written in XML, for instance).</para></listitem>
</itemizedlist>
<para>Linux comes with a lot of formatting tools, such as <command>pdf2ps</command>, <command>fax2ps</command> and <command>a2ps</command>.</para>
<para>Apart from these command line tools there are a lot of graphical word processing programs.  Several complete office suites are available, many are free.  These do the formatting automatically upon submission of a print job.  Just to name a few: AbiWord, KWord, StarOffice, OpenOffice, Applix, WordPerfect, etc.</para>
<tip><title>Printing documentation</title>
<para>The man pages contain pre-formatted <command>troff</command> data, they have to be formatted as well.  Printing is done using the <option>-t</option> option:</para>
<cmdsynopsis><command>man <option>-t</option> <parameter>command</parameter> &gt; <filename>man-command.ps</filename></command></cmdsynopsis>
<para>Then print the PostScript file.  If a default print destination is configured for your system/account, you can just issue the command <command>man <option>-t</option> <parameter>command</parameter></command> to send the formatted page to the printer directly.</para><para>For printing Info pages, refer to the Info pages on <command>info</command> (you will need the source code of the command).</para></tip>
</sect3>
<sect3 id="sect_08_01_02_02"><title>Previewing formatted files</title>
<para>Anything you can send to the printer, can normally be sent to the screen as well.  Depending on the file format, you can use one of these commands:</para>
<itemizedlist>
<listitem><para>PostScript files: with the <command>gv</command> (GhostView) command.</para></listitem>
<listitem><para>TeX dvi files: with <command>xdvi</command>.</para></listitem>
<listitem><para>PDF files: <command>xpdf</command> or Adobe's viewer, <command>acroread</command>, which is also available for free.</para></listitem>
</itemizedlist>
</sect3>
</sect2>

</sect1>
<sect1 id="sect_08_02"><title>The server side</title>
<sect2 id="sect_08_02_01"><title>General</title>
<para>Until a couple of years ago, the choice for Linux users was simple:  everyone ran the same old LPD, lifted mostly verbatim out of BSD's Net-2 code.</para>
<para>Today there are a number of systems to choose from.  Some distributions come with LPRng, the original BSD UNIX Line Printer Daemon (LPD) revisited.  LPD is also the name given to the network printing protocol.  This network protocol is spoken not only by the LPD daemon itself, but by essentially every networked print-server, networked printer, and every other print spooler out there; LPD is the least common denominator of standards-based network printing.
</para>
<para> LPRng is a far better implementation of the basic LPD design than the regular one; if you must use LPD, consider using LPRng instead. There is far less voodoo involved in making it do what you want, and what voodoo there is is well documented.</para>
<para>LPRng is easier to administer for large installations (read: more than one printer, any serial printers, or any peculiar non-lpd network printers) and has a less haphazard code base than does stock lpd. It can even honestly claim to be secure - there are no SUID binaries, and it supports authentication via PGP or Kerberos.
</para>
<para>An interesting new project is the Common UNIX Print System, an implementation of the Internet Printing Protocol (IPP), an HTTP-like RFC standard replacement protocol for the venerable (and clunky) LPD protocol.  CUPS is distributed under the GNU Public License.  CUPS is also the default print system on MacOS X.</para>
<para>
More information can be found at <ulink url="http://www.cups.org">the CUPS homepage</ulink>.</para>
</sect2>
<sect2 id="sect_08_02_02"><title>Graphical printer configuartion</title>
<para>Most distributions come with a GUI for configuring networked and local (parallel port) printers.  They let you choose the printer type from a list and allow easy testing.  You don't have to bother about syntax and location of configuration files.  Check your system documentation before you attempt installing your printer.</para>
</sect2>
<sect2 id="sect_08_02_04"><title>Buying a printer for Linux</title>
<para> The Linux kernel will let you speak with any printer that you can plug into a serial, parallel, or USB port, plus any printer on the network, but this alone is insufficient; you must also be able to generate data that the printer will understand.</para>
<para>Linux supports almost any HP- and/or IBM-compatible printer.  Generally, all printers that can be used on Windows NT or UNIX are fit for Linux as well.</para>
<para>Printers that only come with a Win9x driver could be problematic if they have no other support.  Check with the hardware compatibility HOWTO when in doubt.</para>
<para>Your best choice would be a printer with native PostScript support in the firmware, since nearly all UNIX or Linux software producing printable output, produces it in PostScript, the publishing industry's printer control language of choice.  PostScript printers are usually a bit more expensive, but it is a device-independent, open programming language.</para>
</sect2>
</sect1>
<sect1 id="sect_08_03"><title>Print problems</title>
<para>In this section, we will discuss what you can do as a user when something goes wrong.  We won't discuss any problems that have to do with the daemon-part of the printing service, as that is a task for system administrators.</para>
<sect2 id="sect_08_03_01"><title>Wrong file</title>
<para>If you print the wrong file, the job may be canceled using the command <command>lprm <parameter>jobID</parameter></command>, where jobID is in the form <emphasis>printername-printjobnumber</emphasis> (get it from information displayed by <command>lpq</command>).  This will work when other jobs are waiting to be printed in this printer's queue.  However, you have to be really quick if you are the only one using this printer, since jobs are usually spooled and send to the printer in only seconds.  Once they arrive on the printer, it is too late to remove jobs using Linux tools.</para>
</sect2>
<sect2 id="sect_08_03_02">
<title>My print hasn't come out</title>
<para>Use the <command>lpq</command> command and see if you can spot your job:</para>
<screen>
<prompt>elly:~&gt;</prompt> <command>lpq</command>
Printer: lp@blob
 Queue: 2 printable jobs
 Server: pid 29998 active
 Unspooler: pid 29999 active
 Status: waiting for subserver to exit at 09:43:20.699
 Rank   Owner/ID             Class Job Files          Size Time
1      elly@blob+997           A   997 (STDIN)         129 09:42:54
2      elly@blob+22            A    22 /etc/profile    917 09:43:20
</screen>
<para>Lots of printers have web interfaces these days, which can display status information by typing the printer's IP address in your web browser:</para>
<figure><title>Printer Status through web interface</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/brother-webinterface.eps" format="EPS"></imagedata>
</imageobject>
<imageobject>
<imagedata fileref="images/brother-webinterface.png" format="PNG"></imagedata>
</imageobject>
</mediaobject>
</figure>



<para>If your job ID is not there and not on the printer, contact your system administrator.  If your job ID is listed in the output, check that the printer is currently printing.  If so, just wait, your job will get done in due time.</para>
<para>If the printer is not printing, check that it has paper, check the physical connections to both electricity and data network.  If that's okay, the printer may need restarting.  Ask your system admin for advice.</para>
<para>In the case of a network printer, try printing from another host.  If the printer is reachable from your own host (see <xref linkend="chap_10" /> for the <command>ping</command> utility), you may try to put the formatted file on it, like <filename>file.ps</filename> in case of a PostScript printer, using an FTP client.  If that works, your print system is misconfigured.  If it doesn't work, maybe the printer doesn't understand the format you are feeding it.</para>
<para>The <ulink url="http://www.linuxprinting.org">GNU/Linux Printing site</ulink> contains more tips and tricks.</para>
</sect2>
</sect1>
<sect1 id="sect_08_05"><title>Summary</title>
<para>The Linux print service comes with a set of printing tools based on the standard UNIX LPD tools.  Below is a list of print-related commands.</para>
<table frame="all"><title>Printing related commands</title>
<tgroup cols="2" align="left" colsep="1" rowsep="1">
<thead>
<row>
<entry>Command</entry><entry>Meaning</entry>
</row>
</thead>
<tbody>
<row>
<entry><command>lpr</command></entry><entry>Print file</entry>
</row>
<row>
<entry><command>lpq</command></entry><entry>Query print queue</entry>
</row>
<row>
<entry><command>lprm</command></entry><entry>Remove print job</entry>
</row>
<row>
<entry><command>acroread</command></entry><entry>PDF viewer</entry>
</row>
<row>
<entry><command>groff</command></entry><entry>Formatting tool</entry>
</row>
<row>
<entry><command>gv</command></entry><entry>PostScript viewer</entry>
</row>
<row>
<entry><command>printconf</command></entry><entry>Configure printers</entry>
</row>
<row>
<entry><command>xdvi</command></entry><entry>DVI viewer</entry>
</row>
<row>
<entry><command>xpdf</command></entry><entry>PDF viewer</entry>
</row>
<row>
<entry><command>*2ps</command></entry><entry>Convert file to PostScript</entry>
</row>
</tbody>
</tgroup>
</table>
</sect1>
<sect1 id="sect_08_06"><title>Exercises</title>
<para>Configuring and testing printers involves being in the possession of one, and having access to the <emphasis>root</emphasis> account.  If so, you may try:</para>
<itemizedlist>
<listitem><para>Installing the printer using the GUI on your system.</para></listitem>
<listitem><para>Printing a test page using the GUI.</para></listitem>
<listitem><para>Printing a test page using the <command>lp</command> command.</para></listitem>
<listitem><para>Print from within an application, for example Mozilla or OpenOffice, by choosing <menuchoice><guimenu>File</guimenu><guimenuitem>Print</guimenuitem></menuchoice> from the menu.</para></listitem>
<listitem><para>Disconnect the printer from the network or the local machine/print-server.  What happens when you try to print something?</para></listitem>
</itemizedlist>
<para>The following exercises can be done without printer or root access.</para>
<itemizedlist>
<listitem><para>Try to make PostScript files from different source files, (e.g. HTML, PDF, man pages).  Test the results with the <command>gv</command> viewer.</para></listitem>
<listitem><para>Check that the print daemon is running.</para></listitem>
<listitem><para>Print the files anyway.  What happens?</para></listitem>
<listitem><para>Make a PostScript file using Mozilla.  Test it with <command>gv</command>.</para></listitem>
<listitem><para>Convert it to PDF format.  Test with <command>xpdf</command>.</para></listitem>
<listitem><para>How would you go about printing a GIF file from the command line?</para></listitem>
<listitem><para>Use <command>a2ps</command> to print the <filename>/etc/profile</filename> file to an output file.  Test again with <command>gv</command>.  What happens if you don't specify an output file?</para></listitem>
</itemizedlist>
</sect1>
</chapter>
